(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{442:function(s,a,t){"use strict";t.r(a);var e=t(7),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h5",{attrs:{id:"命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#命令"}},[s._v("#")]),s._v(" 命令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" zookeeper "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /opt/zookeeper/conf/zoo.cfg:/conf/zoo.cfg "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /opt/zookeeper/data:/data "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /opt/zookeeper/logs:/logs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  zookeeper:3.7\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("以下是基于三台物理机（IP: "),a("code",[s._v("10.143.143.101")]),s._v("、"),a("code",[s._v("10.143.143.102")]),s._v("、"),a("code",[s._v("10.143.143.103")]),s._v("）通过 Docker 搭建 ZooKeeper 集群的完整方案，整合多篇实践指南的核心步骤，并提供优化建议：")]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"🔧-一、环境准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🔧-一、环境准备"}},[s._v("#")]),s._v(" 🔧 "),a("strong",[s._v("一、环境准备")])]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("基础要求")]),s._v(" "),a("ul",[a("li",[s._v("三台主机均已安装 Docker 和 Docker Compose（≥20.10）。")]),s._v(" "),a("li",[a("strong",[s._v("开放端口")]),s._v("：\n"),a("ul",[a("li",[a("code",[s._v("2181")]),s._v("（客户端访问）")]),s._v(" "),a("li",[a("code",[s._v("2888")]),s._v("（节点间通信）")]),s._v(" "),a("li",[a("code",[s._v("3888")]),s._v("（选举端口）。")])])]),s._v(" "),a("li",[s._v("确保三台主机网络互通（禁用防火墙或配置端口白名单）。")])])])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"🐘-二、部署-zookeeper-集群-host-网络模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🐘-二、部署-zookeeper-集群-host-网络模式"}},[s._v("#")]),s._v(" 🐘 "),a("strong",[s._v("二、部署 ZooKeeper 集群（Host 网络模式）")])]),s._v(" "),a("p",[a("strong",[s._v("推荐生产环境使用 Host 模式")]),s._v("，避免容器网络隔离问题。")]),s._v(" "),a("h4",{attrs:{id:"步骤-1-每台主机创建配置目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤-1-每台主机创建配置目录"}},[s._v("#")]),s._v(" "),a("strong",[s._v("步骤 1：每台主机创建配置目录")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 三台主机均执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /data/zookeeper/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("conf,data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/zookeeper/conf\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" zoo.cfg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/data/myid\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"步骤-2-配置-zoo-cfg-三台主机相同"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤-2-配置-zoo-cfg-三台主机相同"}},[s._v("#")]),s._v(" "),a("strong",[s._v("步骤 2：配置 zoo.cfg（三台主机相同）")])]),s._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# zoo.cfg 内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("tickTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("2000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("initLimit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("10")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("syncLimit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("5")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("dataDir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/data")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("clientPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("2181")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("quorumListenOnAllIPs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true  # 关键！确保跨主机通信")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server.101")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("10.143.143.101:2888:3888")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server.102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("10.143.143.102:2888:3888")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server.103")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("10.143.143.103:2888:3888")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h4",{attrs:{id:"步骤-3-配置-myid-每台主机唯一"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤-3-配置-myid-每台主机唯一"}},[s._v("#")]),s._v(" "),a("strong",[s._v("步骤 3：配置 myid（每台主机唯一）")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("主机 101")]),s._v("："),a("code",[s._v("echo 101 > /data/zookeeper/data/myid")])]),s._v(" "),a("li",[a("strong",[s._v("主机 102")]),s._v("："),a("code",[s._v("echo 102 > /data/zookeeper/data/myid")])]),s._v(" "),a("li",[a("strong",[s._v("主机 103")]),s._v("："),a("code",[s._v("echo 103 > /data/zookeeper/data/myid")])])]),s._v(" "),a("h4",{attrs:{id:"步骤-4-启动容器-三台主机分别执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤-4-启动容器-三台主机分别执行"}},[s._v("#")]),s._v(" "),a("strong",[s._v("步骤 4：启动容器（三台主机分别执行）")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" zookeeper "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用主机网络")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /data/zookeeper/conf/zoo.cfg:/conf/zoo.cfg "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /data/zookeeper/data:/data "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  zookeeper:3.7  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 推荐稳定版本")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("blockquote",[a("p",[s._v("✅ "),a("strong",[s._v("关键点")]),s._v("：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("--network host")]),s._v(" 直接使用宿主机网络栈，避免端口映射问题。")]),s._v(" "),a("li",[a("code",[s._v("quorumListenOnAllIPs=true")]),s._v(" 确保跨节点通信正常。")])])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"🌐-三、备选方案-自定义-docker-网络模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🌐-三、备选方案-自定义-docker-网络模式"}},[s._v("#")]),s._v(" 🌐 "),a("strong",[s._v("三、备选方案：自定义 Docker 网络模式")])]),s._v(" "),a("p",[a("strong",[s._v("适用场景")]),s._v("：单机多节点测试（需避免端口冲突）。")]),s._v(" "),a("h4",{attrs:{id:"步骤-1-创建共享网络-任一主机执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤-1-创建共享网络-任一主机执行"}},[s._v("#")]),s._v(" "),a("strong",[s._v("步骤 1：创建共享网络")]),s._v("（任一主机执行）")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" network create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--subnet")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".0.0/24 zk-net\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"步骤-2-编写-docker-compose-yml-三台主机配置不同"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤-2-编写-docker-compose-yml-三台主机配置不同"}},[s._v("#")]),s._v(" "),a("strong",[s._v("步骤 2：编写 docker-compose.yml（三台主机配置不同）")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机 101 的配置（其他主机修改 IP 和 broker.id）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.7'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("zoo101")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.7")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" zoo101\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("zk-net")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ipv4_address")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10.10.0.101  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 固定 IP")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /data/zookeeper/data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/data\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ZOO_MY_ID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ZOO_SERVERS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"server.101=10.10.0.101:2888:3888;server.102=10.10.0.102:2888:3888;server.103=10.10.0.103:2888:3888"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("zk-net")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("external")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("blockquote",[a("p",[s._v("⚠️ "),a("strong",[s._v("注意")]),s._v("：")]),s._v(" "),a("ul",[a("li",[s._v("需在三台主机分别配置不同的 "),a("code",[s._v("ZOO_MY_ID")]),s._v(" 和容器 IP（如主机 102 用 "),a("code",[s._v("102")]),s._v(" 和 "),a("code",[s._v("10.10.0.102")]),s._v("）。")]),s._v(" "),a("li",[s._v("生产环境不推荐此模式，因跨主机网络需额外配置（如 overlay 网络）。")])])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"✅-四、集群验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#✅-四、集群验证"}},[s._v("#")]),s._v(" ✅ "),a("strong",[s._v("四、集群验证")])]),s._v(" "),a("ol",[a("li",[a("p",[a("strong",[s._v("检查节点状态")]),s._v("（任选一台主机）")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" zookeeper zkServer.sh status\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("输出示例")]),s._v("：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Mode: leader")]),s._v("（主节点）")]),s._v(" "),a("li",[a("code",[s._v("Mode: follower")]),s._v("（从节点）")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("测试客户端连接")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.143")]),s._v(".143.101 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2181")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看节点状态")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"⚙️-五、生产环境优化建议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#⚙️-五、生产环境优化建议"}},[s._v("#")]),s._v(" ⚙️ "),a("strong",[s._v("五、生产环境优化建议")])]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("数据持久化")]),s._v("：\n"),a("ul",[a("li",[s._v("挂载宿主机目录："),a("code",[s._v("-v /data/zookeeper/data:/data")]),s._v("。")])])]),s._v(" "),a("li",[a("strong",[s._v("资源限制")]),s._v("：\n"),a("ul",[a("li",[s._v("限制容器内存："),a("code",[s._v("--memory 1g --cpus 1")]),s._v("。")])])]),s._v(" "),a("li",[a("strong",[s._v("日志管理")]),s._v("：\n"),a("ul",[a("li",[s._v("挂载日志目录："),a("code",[s._v("-v /data/zookeeper/logs:/logs")]),s._v("。")])])]),s._v(" "),a("li",[a("strong",[s._v("高可用配置")]),s._v("：\n"),a("ul",[a("li",[s._v("确保 "),a("code",[s._v("replication-factor >= 3")]),s._v("（容忍单节点故障）。")])])])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"⚠️-六、常见问题解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#⚠️-六、常见问题解决"}},[s._v("#")]),s._v(" ⚠️ "),a("strong",[s._v("六、常见问题解决")])]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("节点无法选举 Leader")]),s._v(" "),a("ul",[a("li",[s._v("检查 "),a("code",[s._v("myid")]),s._v(" 文件是否唯一且与 "),a("code",[s._v("server.x")]),s._v(" 的 ID 匹配。")]),s._v(" "),a("li",[s._v("确认防火墙开放 "),a("code",[s._v("2888")]),s._v("/"),a("code",[s._v("3888")]),s._v(" 端口。")])])]),s._v(" "),a("li",[a("strong",[s._v("容器跨主机无法通信")]),s._v(" "),a("ul",[a("li",[s._v("Host 模式：确保宿主机 IP 配置正确（禁用 "),a("code",[s._v("localhost")]),s._v("）。")]),s._v(" "),a("li",[s._v("自定义网络：检查 Docker 跨主机网络配置（如 Calico）。")])])]),s._v(" "),a("li",[a("strong",[s._v("启动失败")]),s._v(" "),a("ul",[a("li",[s._v("查看日志："),a("code",[s._v("docker logs zookeeper")]),s._v("，重点检查 "),a("code",[s._v("zoo.cfg")]),s._v(" 语法和 IP 错误。")])])])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"💎-总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#💎-总结"}},[s._v("#")]),s._v(" 💎 "),a("strong",[s._v("总结")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[a("strong",[s._v("方案")])]),s._v(" "),a("th",[a("strong",[s._v("适用场景")])]),s._v(" "),a("th",[a("strong",[s._v("关键配置")])])])]),s._v(" "),a("tbody",[a("tr",[a("td",[a("strong",[s._v("Host 网络")])]),s._v(" "),a("td",[s._v("生产环境（多主机）")]),s._v(" "),a("td",[a("code",[s._v("--network host")]),s._v(" + 宿主机 IP 绑定")])]),s._v(" "),a("tr",[a("td",[a("strong",[s._v("自定义网络")])]),s._v(" "),a("td",[s._v("测试环境（单主机）")]),s._v(" "),a("td",[s._v("固定容器 IP + 跨主机网络插件")])])])]),s._v(" "),a("p",[a("strong",[s._v("推荐选择")]),s._v("：三台物理机部署"),a("strong",[s._v("优先采用 Host 网络模式")]),s._v("，配置简单且性能接近原生。若需进一步简化运维，可结合 Docker Compose 批量管理。")])])}),[],!1,null,null,null);a.default=n.exports}}]);
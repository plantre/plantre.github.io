(window.webpackJsonp=window.webpackJsonp||[]).push([[103],{460:function(t,s,a){"use strict";a.r(s);var n=a(7),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("å‘ Kafka ä¸­å‘é€é‡å¤çš„æ•°æ®ä¼šå¯¼è‡´æ¶ˆæ¯è¢«å¤šæ¬¡å­˜å‚¨æˆ–æ¶ˆè´¹ï¼Œå…·ä½“ç»“æœå–å†³äº Kafka çš„é…ç½®å’Œæ¶ˆæ¯å¤„ç†ç­–ç•¥ã€‚ä»¥ä¸‹æ˜¯ä¸åŒåœºæ™¯ä¸‹çš„æ ¸å¿ƒå½±å“åŠè§£å†³æ–¹æ¡ˆï¼š")]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"âš ï¸-ä¸€ã€æ— é˜²æŠ¤æœºåˆ¶æ—¶-æ¶ˆæ¯å¿…ç„¶é‡å¤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#âš ï¸-ä¸€ã€æ— é˜²æŠ¤æœºåˆ¶æ—¶-æ¶ˆæ¯å¿…ç„¶é‡å¤"}},[t._v("#")]),t._v(" âš ï¸ "),s("strong",[t._v("ä¸€ã€æ— é˜²æŠ¤æœºåˆ¶æ—¶ï¼šæ¶ˆæ¯å¿…ç„¶é‡å¤")])]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("ç”Ÿäº§è€…é‡è¯•æœºåˆ¶å¯¼è‡´é‡å¤")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("åŸå› ")]),t._v("ï¼šå½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åæœªæ”¶åˆ° Broker çš„ç¡®è®¤ï¼ˆå¦‚ç½‘ç»œæŠ–åŠ¨ã€Broker æ•…éšœï¼‰ï¼Œä¼šè§¦å‘é‡è¯•æœºåˆ¶ï¼Œå¯¼è‡´åŒä¸€æ¡æ¶ˆæ¯è¢«å¤šæ¬¡å‘é€ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("è¡¨ç°")]),t._v("ï¼šBroker ä¼šå°†é‡å¤æ¶ˆæ¯è§†ä¸ºç‹¬ç«‹æ¶ˆæ¯å­˜å‚¨ï¼Œæ¶ˆè´¹è€…å¯èƒ½å¤šæ¬¡æ¶ˆè´¹ç›¸åŒæ•°æ®ã€‚")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("æ•°æ®ä¹±åºé—®é¢˜")])]),t._v(" "),s("ul",[s("li",[t._v("è‹¥é‡è¯•æ¶ˆæ¯ä¸åç»­æ¶ˆæ¯é¡ºåºé”™ä¹±ï¼ˆå¦‚æ¶ˆæ¯1å¤±è´¥é‡å‘æ—¶ï¼Œæ¶ˆæ¯2å·²å†™å…¥ï¼‰ï¼ŒBroker å­˜å‚¨é¡ºåºå˜ä¸º "),s("code",[t._v("æ¶ˆæ¯2 â†’ æ¶ˆæ¯1")]),t._v("ï¼Œç ´åä¸šåŠ¡é€»è¾‘ã€‚")])])])]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"ğŸ›¡ï¸-äºŒã€kafka-å†…ç½®é˜²é‡å¤æœºåˆ¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ›¡ï¸-äºŒã€kafka-å†…ç½®é˜²é‡å¤æœºåˆ¶"}},[t._v("#")]),t._v(" ğŸ›¡ï¸ "),s("strong",[t._v("äºŒã€Kafka å†…ç½®é˜²é‡å¤æœºåˆ¶")])]),t._v(" "),s("h4",{attrs:{id:"_1-å¹‚ç­‰æ€§ç”Ÿäº§è€…-idempotence"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-å¹‚ç­‰æ€§ç”Ÿäº§è€…-idempotence"}},[t._v("#")]),t._v(" 1. "),s("strong",[t._v("å¹‚ç­‰æ€§ç”Ÿäº§è€…ï¼ˆIdempotenceï¼‰")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("åŸç†")]),t._v("ï¼š\n"),s("ul",[s("li",[t._v("æ¯ä¸ªç”Ÿäº§è€…åˆ†é…å”¯ä¸€ "),s("code",[t._v("PID")]),t._v("ï¼Œæ¯æ¡æ¶ˆæ¯ç»‘å®šåˆ†åŒºçº§å•è°ƒé€’å¢åºåˆ—å· "),s("code",[t._v("SequenceNumber")]),t._v("ã€‚")]),t._v(" "),s("li",[t._v("Broker ç¼“å­˜æœ€è¿‘5ä¸ªåºåˆ—å·ï¼Œæ‹’ç»é‡å¤æˆ–ä¹±åºçš„åºåˆ—å·ï¼ˆå¦‚ "),s("code",[t._v("seq_num")]),t._v(" â‰¤ ç¼“å­˜æœ€å¤§å€¼ï¼‰ã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("é…ç½®")]),t._v("ï¼š"),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("spring.kafka.producer.properties.enable.idempotence=true\nspring.kafka.producer.acks=all           "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å¿…é¡»è®¾ä¸º all")]),t._v("\nmax.in.flight.requests.per.connectionâ‰¤5  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# é¿å…ä¹±åº")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])])]),t._v(" "),s("li",[s("strong",[t._v("å±€é™")]),t._v("ï¼šä»…ä¿è¯å•åˆ†åŒºã€å•ä¼šè¯ï¼ˆç”Ÿäº§è€…é‡å¯åå¤±æ•ˆï¼‰çš„æ¶ˆæ¯ä¸é‡å¤ã€‚")])]),t._v(" "),s("h4",{attrs:{id:"_2-äº‹åŠ¡-transactions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-äº‹åŠ¡-transactions"}},[t._v("#")]),t._v(" 2. "),s("strong",[t._v("äº‹åŠ¡ï¼ˆTransactionsï¼‰")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("åŸç†")]),t._v("ï¼š\n"),s("ul",[s("li",[t._v("è·¨åˆ†åŒºåŸå­å†™å…¥ï¼šäº‹åŠ¡å†…å¤šæ¡æ¶ˆæ¯è¦ä¹ˆå…¨éƒ¨æäº¤ï¼Œè¦ä¹ˆå…¨éƒ¨ä¸¢å¼ƒã€‚")]),t._v(" "),s("li",[t._v("é€šè¿‡ "),s("code",[t._v("transactional.id")]),t._v(" å…³è”ç”Ÿäº§è€…ä¼šè¯ï¼Œé‡å¯åä»èƒ½é˜²é‡å¤ã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("é…ç½®")]),t._v("ï¼š"),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"transactional.id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tx-producer-1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nproducer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initTransactions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    producer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("beginTransaction")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    producer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("record1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    producer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("record2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    producer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitTransaction")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    producer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("abortTransaction")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])])]),t._v(" "),s("li",[s("strong",[t._v("ä¼˜åŠ¿")]),t._v("ï¼šæ”¯æŒå¤šåˆ†åŒºã€è·¨ä¼šè¯çš„ç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰ï¼ˆExactly-Onceï¼‰ã€‚")])]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"ğŸ”„-ä¸‰ã€æ¶ˆè´¹è€…ç«¯é‡å¤æ¶ˆè´¹åŠåº”å¯¹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ”„-ä¸‰ã€æ¶ˆè´¹è€…ç«¯é‡å¤æ¶ˆè´¹åŠåº”å¯¹"}},[t._v("#")]),t._v(" ğŸ”„ "),s("strong",[t._v("ä¸‰ã€æ¶ˆè´¹è€…ç«¯é‡å¤æ¶ˆè´¹åŠåº”å¯¹")])]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("é‡å¤æ¶ˆè´¹åŸå› ")])]),t._v(" "),s("ul",[s("li",[t._v("æ¶ˆè´¹è€…æäº¤ Offset å‰å´©æºƒï¼Œé‡å¯åä»æ—§ Offset é‡æ–°æ‹‰å–æ¶ˆæ¯ã€‚")]),t._v(" "),s("li",[t._v("å³ä½¿ç”Ÿäº§è€…é˜²é‡å¤ï¼Œæ¶ˆè´¹è€…ä»å¯èƒ½å› æäº¤å¤±è´¥æ”¶åˆ°é‡å¤æ¶ˆæ¯ã€‚")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("è§£å†³æ–¹æ¡ˆ")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("æ¶ˆè´¹è€…å¹‚ç­‰è®¾è®¡")]),t._v("ï¼š\n"),s("ul",[s("li",[s("strong",[t._v("å”¯ä¸€é”®å»é‡")]),t._v("ï¼šåˆ©ç”¨æ•°æ®åº“å”¯ä¸€çº¦æŸï¼ˆå¦‚è”åˆä¸šåŠ¡IDï¼‰ã€‚"),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" orders "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNIQUE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tx_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" user_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- é‡å¤æ’å…¥æŠ›å¼‚å¸¸")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])]),t._v(" "),s("li",[s("strong",[t._v("çŠ¶æ€æ£€æŸ¥")]),t._v("ï¼šç”¨ Redis è®°å½•å·²å¤„ç†æ¶ˆæ¯IDï¼ˆå¦‚ "),s("code",[t._v("SETNX message_id 1")]),t._v("ï¼‰ã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("äº‹åŠ¡å‹æ¶ˆè´¹è€…")]),t._v("ï¼š\n"),s("ul",[s("li",[t._v("é…åˆ Kafka äº‹åŠ¡ï¼Œè®¾ç½® "),s("code",[t._v("isolation.level=read_committed")]),t._v("ï¼Œä»…è¯»å–å·²æäº¤äº‹åŠ¡çš„æ¶ˆæ¯ã€‚")])])])])])]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"ğŸ’-å››ã€æœ€ä½³å®è·µæ€»ç»“"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ’-å››ã€æœ€ä½³å®è·µæ€»ç»“"}},[t._v("#")]),t._v(" ğŸ’ "),s("strong",[t._v("å››ã€æœ€ä½³å®è·µæ€»ç»“")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("åœºæ™¯")])]),t._v(" "),s("th",[t._v("é…ç½®æ–¹æ¡ˆ")]),t._v(" "),s("th",[t._v("æ•ˆæœ")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[t._v("å•åˆ†åŒºé˜²é‡å¤")])]),t._v(" "),s("td",[t._v("å¯ç”¨å¹‚ç­‰æ€§ + "),s("code",[t._v("acks=all")]),t._v(" + "),s("code",[t._v("max.in.flightâ‰¤5")])]),t._v(" "),s("td",[t._v("å•ä¼šè¯å†…æ— é‡å¤ã€æ— ä¹±åº")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("å¤šåˆ†åŒº/è·¨ä¼šè¯é˜²é‡å¤")])]),t._v(" "),s("td",[t._v("å¯ç”¨äº‹åŠ¡ + "),s("code",[t._v("transactional.id")])]),t._v(" "),s("td",[t._v("åŸå­å†™å…¥ã€é‡å¯ä¸é‡å¤")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("æ¶ˆè´¹è€…ç«¯é˜²é‡å¤")])]),t._v(" "),s("td",[t._v("ä¸šåŠ¡å¹‚ç­‰è®¾è®¡ï¼ˆDBå”¯ä¸€é”®/Redisç¼“å­˜ï¼‰")]),t._v(" "),s("td",[t._v("å…œåº•å»é‡ï¼Œå…¼å®¹æ‰€æœ‰åœºæ™¯")])])])]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("ç”Ÿäº§ç¯å¢ƒå»ºè®®")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("å…³é”®ä¸šåŠ¡ï¼š"),s("strong",[t._v("ç”Ÿäº§è€…äº‹åŠ¡ + æ¶ˆè´¹è€…å¹‚ç­‰")]),t._v(" åŒé‡ä¿éšœã€‚")]),t._v(" "),s("li",[t._v("é«˜åååœºæ™¯ï¼šå¯ç”¨å¹‚ç­‰æ€§ï¼Œç‰ºç‰²éƒ¨åˆ†çµæ´»æ€§æ¢å–æ€§èƒ½ã€‚")]),t._v(" "),s("li",[t._v("æ—¥å¿—ç±»æ•°æ®ï¼šå¯æ¥å— "),s("code",[t._v("acks=1")]),t._v("ï¼Œå®¹å¿å°‘é‡é‡å¤ä»¥æå‡ååé‡ã€‚")])])]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("é€šè¿‡åˆç†é…ç½® Kafka çš„"),s("strong",[t._v("å¹‚ç­‰æ€§")]),t._v("å’Œ"),s("strong",[t._v("äº‹åŠ¡")]),t._v("ï¼Œç»“åˆ"),s("strong",[t._v("æ¶ˆè´¹è€…ç«¯çš„ä¸šåŠ¡å¹‚ç­‰è®¾è®¡")]),t._v("ï¼Œå¯æœ‰æ•ˆè§£å†³é‡å¤æ¶ˆæ¯é—®é¢˜ï¼Œå®ç°ä»ç”Ÿäº§åˆ°æ¶ˆè´¹çš„ç«¯åˆ°ç«¯ç²¾ç¡®ä¸€æ¬¡å¤„ç†ï¼ˆExactly-Onceï¼‰ã€‚")])])}),[],!1,null,null,null);s.default=r.exports}}]);
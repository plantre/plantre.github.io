(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{453:function(r,t,v){"use strict";v.r(t);var _=v(7),s=Object(_.a)({},(function(){var r=this,t=r._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":r.$parent.slotKey}},[t("p",[r._v("在Kafka中，"),t("strong",[r._v("分区数（Partitions）和副本数（Replication Factor）的配置需结合业务需求、集群规模及容错要求")]),r._v("综合设计。以下是具体建议及3个Broker时的分布逻辑：")]),r._v(" "),t("hr"),r._v(" "),t("h3",{attrs:{id:"📊-一、分区数设置原则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#📊-一、分区数设置原则"}},[r._v("#")]),r._v(" 📊 "),t("strong",[r._v("一、分区数设置原则")])]),r._v(" "),t("ol",[t("li",[t("p",[t("strong",[r._v("核心公式")]),r._v("（参考性能基准）：")]),r._v(" "),t("ul",[t("li",[t("strong",[r._v("分区数 = 目标吞吐量 / min(单分区生产吞吐量, 单分区消费吞吐量)")]),r._v(" "),t("ul",[t("li",[r._v("例如：目标吞吐量100MB/s，单分区生产/消费能力20MB/s → 分区数=5。")])])]),r._v(" "),t("li",[t("strong",[r._v("经验公式")]),r._v("：分区数 ≈ 最大消费者实例数 × 2~3（冗余系数）。")])])]),r._v(" "),t("li",[t("p",[t("strong",[r._v("场景化建议")]),r._v("（参考通用实践）：")]),r._v(" "),t("table",[t("thead",[t("tr",[t("th",[t("strong",[r._v("业务场景")])]),r._v(" "),t("th",[t("strong",[r._v("推荐分区数")])]),r._v(" "),t("th",[t("strong",[r._v("说明")])])])]),r._v(" "),t("tbody",[t("tr",[t("td",[r._v("低吞吐（日志采集）")]),r._v(" "),t("td",[r._v("1~3")]),r._v(" "),t("td",[r._v("避免资源浪费")])]),r._v(" "),t("tr",[t("td",[r._v("中等负载（订单处理）")]),r._v(" "),t("td",[r._v("10~30")]),r._v(" "),t("td",[r._v("匹配10~20个消费者实例")])]),r._v(" "),t("tr",[t("td",[r._v("高吞吐（实时流处理）")]),r._v(" "),t("td",[r._v("按公式计算")]),r._v(" "),t("td",[r._v("单Broker分区数建议<3000")])]),r._v(" "),t("tr",[t("td",[r._v("需全局消息顺序")]),r._v(" "),t("td",[t("strong",[r._v("1")])]),r._v(" "),t("td",[r._v("牺牲并发性保顺序性")])])])])]),r._v(" "),t("li",[t("p",[t("strong",[r._v("注意事项")]),r._v("：")]),r._v(" "),t("ul",[t("li",[r._v("分区数"),t("strong",[r._v("只能增加不能减少")]),r._v("（动态扩容时需评估Key哈希变化）。")]),r._v(" "),t("li",[r._v("过多分区导致元数据膨胀、选举延迟增加（单Broker建议<200分区）。")])])])]),r._v(" "),t("hr"),r._v(" "),t("h3",{attrs:{id:"🔒-二、副本数设置原则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🔒-二、副本数设置原则"}},[r._v("#")]),r._v(" 🔒 "),t("strong",[r._v("二、副本数设置原则")])]),r._v(" "),t("ol",[t("li",[t("p",[t("strong",[r._v("容错性与可靠性")]),r._v("：")]),r._v(" "),t("ul",[t("li",[t("strong",[r._v("生产环境")]),r._v("：至少 "),t("strong",[r._v("3副本")]),r._v("（可容忍1个Broker宕机）。")]),r._v(" "),t("li",[t("strong",[r._v("关键业务")]),r._v("：3~5副本（容忍2节点故障）。")]),r._v(" "),t("li",[t("strong",[r._v("开发测试")]),r._v("：1~2副本（节省资源）。")])])]),r._v(" "),t("li",[t("p",[t("strong",[r._v("副本数限制")]),r._v("：")]),r._v(" "),t("ul",[t("li",[t("strong",[r._v("副本数 ≤ Broker数量")]),r._v("（否则创建失败）。"),t("br"),r._v("\n例如：3个Broker时，副本数最大为3。")])])])]),r._v(" "),t("hr"),r._v(" "),t("h3",{attrs:{id:"⚙️-三、3个broker时的分布逻辑"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#⚙️-三、3个broker时的分布逻辑"}},[r._v("#")]),r._v(" ⚙️ "),t("strong",[r._v("三、3个Broker时的分布逻辑")])]),r._v(" "),t("p",[r._v("当集群仅有3个Broker时，Kafka通过"),t("strong",[r._v("自动负载均衡策略")]),r._v("分配分区与副本，确保高可用：")]),r._v(" "),t("ol",[t("li",[t("p",[t("strong",[r._v("分区分布")]),r._v("：")]),r._v(" "),t("ul",[t("li",[r._v("分区会尽量"),t("strong",[r._v("均匀分布到所有Broker")]),r._v("上。"),t("br"),r._v(" "),t("em",[r._v("例如：3分区的Topic，每个Broker分配1个分区（Leader）。")])])])]),r._v(" "),t("li",[t("p",[t("strong",[r._v("副本分布")]),r._v("：")]),r._v(" "),t("ul",[t("li",[r._v("每个分区的副本"),t("strong",[r._v("分散在不同Broker")]),r._v("（避免单点故障）。"),t("br"),r._v(" "),t("em",[r._v("例如：3分区+3副本的Topic分布如下：")])])]),r._v(" "),t("table",[t("thead",[t("tr",[t("th",[t("strong",[r._v("分区")])]),r._v(" "),t("th",[t("strong",[r._v("Leader副本")])]),r._v(" "),t("th",[t("strong",[r._v("Follower副本")])])])]),r._v(" "),t("tbody",[t("tr",[t("td",[r._v("Partition 0")]),r._v(" "),t("td",[r._v("Broker 1")]),r._v(" "),t("td",[r._v("Broker 2, Broker 3")])]),r._v(" "),t("tr",[t("td",[r._v("Partition 1")]),r._v(" "),t("td",[r._v("Broker 2")]),r._v(" "),t("td",[r._v("Broker 1, Broker 3")])]),r._v(" "),t("tr",[t("td",[r._v("Partition 2")]),r._v(" "),t("td",[r._v("Broker 3")]),r._v(" "),t("td",[r._v("Broker 1, Broker 2")])])])])]),r._v(" "),t("li",[t("p",[t("strong",[r._v("故障恢复")]),r._v("：")]),r._v(" "),t("ul",[t("li",[r._v("若Broker 1宕机：\n"),t("ul",[t("li",[r._v("Partition 0的Leader自动切换到Broker 2或3（由ISR选举）。")]),r._v(" "),t("li",[r._v("其他分区不受影响。")])])])])])]),r._v(" "),t("hr"),r._v(" "),t("h3",{attrs:{id:"⚠️-四、生产环境配置示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#⚠️-四、生产环境配置示例"}},[r._v("#")]),r._v(" ⚠️ "),t("strong",[r._v("四、生产环境配置示例")])]),r._v(" "),t("ol",[t("li",[t("strong",[r._v("创建命令")]),r._v("（3 Broker集群）："),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[r._v("kafka-topics.sh "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[r._v("--create")]),r._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v("\\")]),r._v("\n  --bootstrap-server localhost:9092 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v("\\")]),r._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[r._v("--topic")]),r._v(" orders "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v("\\")]),r._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[r._v("--partitions")]),r._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[r._v("6")]),r._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v("\\")]),r._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[r._v("# 分区数=消费实例数×2（假设3消费者）")]),r._v("\n  --replication-factor "),t("span",{pre:!0,attrs:{class:"token number"}},[r._v("3")]),r._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[r._v("# 3副本容错")]),r._v("\n")])]),r._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[r._v("1")]),t("br"),t("span",{staticClass:"line-number"},[r._v("2")]),t("br"),t("span",{staticClass:"line-number"},[r._v("3")]),t("br"),t("span",{staticClass:"line-number"},[r._v("4")]),t("br"),t("span",{staticClass:"line-number"},[r._v("5")]),t("br")])])]),r._v(" "),t("li",[t("strong",[r._v("配置建议")]),r._v("：\n"),t("ul",[t("li",[t("strong",[r._v("分区数")]),r._v("：6（匹配消费者并发能力）。")]),r._v(" "),t("li",[t("strong",[r._v("副本数")]),r._v("：3（最大化容错能力）。")])])])]),r._v(" "),t("hr"),r._v(" "),t("h3",{attrs:{id:"💎-总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#💎-总结"}},[r._v("#")]),r._v(" 💎 "),t("strong",[r._v("总结")])]),r._v(" "),t("ul",[t("li",[t("strong",[r._v("分区数")]),r._v("：由吞吐量、消费者并发数决定，"),t("strong",[r._v("避免盲目扩增")]),r._v("（优先基准测试）。")]),r._v(" "),t("li",[t("strong",[r._v("副本数")]),r._v("：生产环境固定为 "),t("strong",[r._v("3")]),r._v("，3 Broker时副本均匀分布。")]),r._v(" "),t("li",[t("strong",[r._v("3 Broker分布")]),r._v("：每个分区及其副本分散在不同节点，Leader分散以均衡负载，Follower同步数据保障高可用。")])])])}),[],!1,null,null,null);t.default=s.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[182],{539:function(v,e,_){"use strict";_.r(e);var n=_(7),s=Object(n.a)({},(function(){var v=this,e=v._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[e("p",[v._v("在 Docker 容器化部署中，若宿主机启用了 SELinux 的 Enforcing 模式（强制安全策略模式），在挂载宿主机目录到容器时添加 "),e("code",[v._v(":Z")]),v._v(" 标志，是解决容器与宿主机文件系统权限冲突的核心机制。以下是其含义和作用的详细解析：")]),v._v(" "),e("hr"),v._v(" "),e("p",[v._v("一、"),e("code",[v._v(":Z")]),v._v(" 的核心作用\n"),e("code",[v._v(":Z")]),v._v(" 是 Docker 对挂载卷的 SELinux 标签重标记操作，目的是让容器内的进程能够合法访问宿主机挂载的目录/文件，同时遵循 SELinux 的强制访问控制（MAC）规则。具体机制如下：")]),v._v(" "),e("ol",[e("li",[e("p",[v._v("重设 SELinux 上下文标签"),e("br"),v._v("\n当容器挂载宿主机目录时，默认的 SELinux 标签（如 "),e("code",[v._v("system_u:object_r:default_t:s0")]),v._v("）可能不符合容器进程的访问策略。"),e("code",[v._v("Z")]),v._v(" 标志会强制将挂载目录的标签修改为 "),e("code",[v._v("container_file_t")]),v._v(" 类型（或其他符合容器策略的标签）。")])]),v._v(" "),e("li",[e("p",[v._v("实现资源隔离"),e("br"),v._v("\n通过 "),e("code",[v._v(":Z")]),v._v(" 标记的目录会被分配唯一且独占的 SELinux 上下文（包含 Category 字段），确保该目录仅能被当前容器访问，其他容器或宿主机进程无法读写此目录，从而增强隔离性。")])]),v._v(" "),e("li",[e("p",[v._v("绕过默认拒绝规则"),e("br"),v._v("\nSELinux 默认策略会阻止容器进程访问未正确标记的宿主机资源。例如，若未添加 "),e("code",[v._v(":Z")]),v._v("，容器内进程可能因标签不匹配触发 "),e("code",[v._v("avc: denied")]),v._v(" 日志错误。")])])]),v._v(" "),e("hr"),v._v(" "),e("p",[v._v("二、"),e("code",[v._v("Z")]),v._v(" 与 "),e("code",[v._v("z")]),v._v(" 的区别")]),v._v(" "),e("table",[e("thead",[e("tr",[e("th",[v._v("标志")]),v._v(" "),e("th",[v._v("作用场景")]),v._v(" "),e("th",[v._v("安全影响")])])]),v._v(" "),e("tbody",[e("tr",[e("td",[e("code",[v._v(":Z")])]),v._v(" "),e("td",[v._v("独占挂载（仅限当前容器访问）")]),v._v(" "),e("td",[v._v("完全重写标签，目录被标记为私有资源，其他容器无法访问（即使使用相同路径）")])]),v._v(" "),e("tr",[e("td",[e("code",[v._v(":z")])]),v._v(" "),e("td",[v._v("共享挂载（多容器共享")]),v._v(" "),e("td")])])]),v._v(" "),e("p",[v._v("怎么看 SELinux 是否处于 Enforcing 模式")]),v._v(" "),e("p",[v._v("根据最新的技术文档和实践总结，以下是检查 SELinux 是否处于 Enforcing（强制）模式 的三种常用方法，适用于 CentOS、Ubuntu 等主流 Linux 发行版：")]),v._v(" "),e("hr"),v._v(" "),e("p",[v._v("一、使用 "),e("code",[v._v("getenforce")]),v._v(" 命令（最快捷）\n直接在终端执行命令，实时显示当前 SELinux 运行模式：")]),v._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[v._v("getenforce\n")])]),v._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[v._v("1")]),e("br")])]),e("p",[v._v("• 输出结果解析：")]),v._v(" "),e("p",[v._v("• "),e("code",[v._v("Enforcing")]),v._v("：处于强制模式，策略规则已生效。")]),v._v(" "),e("p",[v._v("• "),e("code",[v._v("Permissive")]),v._v("：宽容模式（仅记录违规不阻止）。")]),v._v(" "),e("p",[v._v("• "),e("code",[v._v("Disabled")]),v._v("：SELinux 完全禁用。")]),v._v(" "),e("p",[v._v("适用场景：快速确认当前状态，无需额外参数。")]),v._v(" "),e("hr"),v._v(" "),e("p",[v._v("二、查看 "),e("code",[v._v("sestatus")]),v._v(" 命令（信息最全面）\n执行以下命令获取 SELinux 详细状态报告：")]),v._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[v._v("sestatus\n")])]),v._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[v._v("1")]),e("br")])]),e("p",[v._v("• 关键字段解析：")]),v._v(" "),e("p",[v._v("• "),e("code",[v._v("SELinux status")]),v._v("："),e("code",[v._v("enabled")]),v._v(" 表示 SELinux 已启用（可能处于 Enforcing/Permissive 模式）。")]),v._v(" "),e("p",[v._v("• "),e("code",[v._v("Current mode")]),v._v("：显示当前实际运行模式（如 "),e("code",[v._v("enforcing")]),v._v("）。")]),v._v(" "),e("p",[v._v("• "),e("code",[v._v("Mode from config file")]),v._v("：显示重启后生效的模式（如配置文件中设置了 "),e("code",[v._v("enforcing")]),v._v("）。")]),v._v(" "),e("p",[v._v("示例输出（仅节选关键部分）：")]),v._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[v._v("SELinux status: enabled\nCurrent mode: enforcing\nMode from config file: enforcing\n")])]),v._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[v._v("1")]),e("br"),e("span",{staticClass:"line-number"},[v._v("2")]),e("br"),e("span",{staticClass:"line-number"},[v._v("3")]),e("br")])]),e("hr"),v._v(" "),e("p",[v._v("三、检查配置文件 "),e("code",[v._v("/etc/selinux/config")]),v._v("（确认持久化配置）\n查看配置文件中的默认模式设置（需重启生效）：")]),v._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[v._v("cat")]),v._v(" /etc/selinux/config "),e("span",{pre:!0,attrs:{class:"token operator"}},[v._v("|")]),v._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[v._v("grep")]),v._v(" ^SELINUX"),e("span",{pre:!0,attrs:{class:"token operator"}},[v._v("=")]),v._v("\n")])]),v._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[v._v("1")]),e("br")])]),e("p",[v._v("• 配置项解析：")]),v._v(" "),e("p",[v._v("• "),e("code",[v._v("SELINUX=enforcing")]),v._v("：系统重启后自动进入强制模式。")]),v._v(" "),e("p",[v._v("• "),e("code",[v._v("SELINUX=permissive")]),v._v("：重启后进入宽容模式。")]),v._v(" "),e("p",[v._v("• "),e("code",[v._v("SELINUX=disabled")]),v._v("：彻底关闭 SELinux。")]),v._v(" "),e("p",[v._v("注意：若此处为 "),e("code",[v._v("enforcing")]),v._v(" 但当前模式非强制，说明用户通过 "),e("code",[v._v("setenforce")]),v._v(" 临时修改了模式（重启后会恢复配置文件的设定）。")]),v._v(" "),e("hr"),v._v(" "),e("p",[v._v("四、模式切换验证（附加操作）\n如果需要临时切换模式（无需重启）：")]),v._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[v._v("setenforce "),e("span",{pre:!0,attrs:{class:"token number"}},[v._v("1")]),v._v("   "),e("span",{pre:!0,attrs:{class:"token comment"}},[v._v("# 切换为 Enforcing 模式")]),v._v("\nsetenforce "),e("span",{pre:!0,attrs:{class:"token number"}},[v._v("0")]),v._v("   "),e("span",{pre:!0,attrs:{class:"token comment"}},[v._v("# 切换为 Permissive 模式")]),v._v("\n")])]),v._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[v._v("1")]),e("br"),e("span",{staticClass:"line-number"},[v._v("2")]),e("br")])]),e("p",[v._v("验证效果：再次执行 "),e("code",[v._v("getenforce")]),v._v(" 观察输出变化。")]),v._v(" "),e("hr"),v._v(" "),e("p",[v._v("总结对比")]),v._v(" "),e("table",[e("thead",[e("tr",[e("th",[v._v("方法")]),v._v(" "),e("th",[v._v("优势")]),v._v(" "),e("th",[v._v("局限性")])])]),v._v(" "),e("tbody",[e("tr",[e("td",[e("code",[v._v("getenforce")])]),v._v(" "),e("td",[v._v("快速、直接")]),v._v(" "),e("td",[v._v("仅显示当前状态，无持久化配置信息")])]),v._v(" "),e("tr",[e("td",[e("code",[v._v("sestatus")])]),v._v(" "),e("td",[v._v("显示运行模式与配置文件的关联性")]),v._v(" "),e("td",[v._v("输出信息较多，需针对性筛选")])]),v._v(" "),e("tr",[e("td",[v._v("查看配置文件")]),v._v(" "),e("td",[v._v("确认重启后的持久化行为")]),v._v(" "),e("td",[v._v("需手动编辑文件并重启生效")])])])]),v._v(" "),e("p",[v._v("若需长期保持 Enforcing 模式，建议同时修改配置文件并执行 "),e("code",[v._v("setenforce 1")]),v._v(" 以确保当前和重启后的一致性。")])])}),[],!1,null,null,null);e.default=s.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{417:function(s,a,t){"use strict";t.r(a);var e=t(7),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("以下是通过 Docker 搭建 Redis 集群的完整方案，涵盖单机快速部署、多机生产级部署、验证测试及扩容管理，结合多个来源的最佳实践整理而成：")]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"🔧-一、单机快速搭建-开发测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🔧-一、单机快速搭建-开发测试"}},[s._v("#")]),s._v(" 🔧 "),a("strong",[s._v("一、单机快速搭建（开发测试）")])]),s._v(" "),a("p",[s._v("适用于本地学习或测试环境，一台机器模拟多节点集群。")]),s._v(" "),a("h4",{attrs:{id:"步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤"}},[s._v("#")]),s._v(" "),a("strong",[s._v("步骤")]),s._v("：")]),s._v(" "),a("ol",[a("li",[a("p",[a("strong",[s._v("编写 "),a("code",[s._v("docker-compose.yml")])]),a("br"),s._v("\n创建 6 个节点（3 主 3 从）：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.7'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis-node1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6371:6379"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"16371:16379"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("enabled yes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("file nodes.conf "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("timeout 5000 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("appendonly yes\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重复配置 redis-node2 到 redis-node6（端口递增：6372-6376, 16372-16376）")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("启动容器")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("创建集群")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" redis-node1 redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cluster")]),s._v(" create "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.2:6379 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.3:6379 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.4:6379 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.5:6379 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.6:6379 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.7:6379 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --cluster-replicas "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("--cluster-replicas 1")]),s._v("：每个主节点配 1 个从节点。")])])])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"⚙️-二、多机生产部署-3-台服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#⚙️-二、多机生产部署-3-台服务器"}},[s._v("#")]),s._v(" ⚙️ "),a("strong",[s._v("二、多机生产部署（3 台服务器）")])]),s._v(" "),a("p",[s._v("跨物理机部署，保障高可用。")]),s._v(" "),a("h4",{attrs:{id:"步骤-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤-2"}},[s._v("#")]),s._v(" "),a("strong",[s._v("步骤")]),s._v("：")]),s._v(" "),a("ol",[a("li",[a("p",[a("strong",[s._v("每台服务器部署 2 个节点")]),s._v("（共 6 节点）")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器 1（172.16.17.100）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" redis-7000 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7000")]),s._v(":7000 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17000")]),s._v(":17000 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CLUSTER_ANNOUNCE_IP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".17.100 redis:latest "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  redis-server --cluster-enabled "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同服务器启动 redis-7001（端口 7001/17001）")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("blockquote",[a("p",[a("strong",[s._v("重复操作")]),s._v("：")]),s._v(" "),a("ul",[a("li",[s._v("服务器 2（172.16.17.101）：部署 "),a("code",[s._v("redis-7002")]),s._v("、"),a("code",[s._v("redis-7003")])]),s._v(" "),a("li",[s._v("服务器 3（172.16.17.102）：部署 "),a("code",[s._v("redis-7004")]),s._v("、"),a("code",[s._v("redis-7005")]),s._v("。")])])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("创建集群")]),s._v("（任意一台服务器执行）")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" redis-7000 redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cluster")]),s._v(" create "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".17.100:7000 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".17.100:7001 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".17.101:7002 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".17.101:7003 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".17.102:7004 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".17.102:7005 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --cluster-replicas "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[a("strong",[s._v("自动分配")]),s._v("：主从节点会跨物理机分布（如主节点在服务器1，从节点在服务器2）。")])])])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"✅-三、集群验证与测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#✅-三、集群验证与测试"}},[s._v("#")]),s._v(" ✅ "),a("strong",[s._v("三、集群验证与测试")])]),s._v(" "),a("p",[s._v("确保集群正常工作并具备容错能力。")]),s._v(" "),a("ol",[a("li",[a("p",[a("strong",[s._v("检查集群状态")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" redis-7000 redis-cli cluster nodes\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("预期输出")]),s._v("：")]),s._v(" "),a("ul",[a("li",[s._v("3 个 "),a("code",[s._v("master")]),s._v(" 在线，每个 "),a("code",[s._v("master")]),s._v(" 有 1 个 "),a("code",[s._v("slave")])]),s._v(" "),a("li",[s._v("所有 Slot（16384 个）已分配完成。")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("数据读写测试")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 节点1写入")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" redis-7000 redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" user:101 "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Alice"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 节点2读取（自动重定向）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" redis-7002 redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" get user:101  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 返回 "Alice"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("故障转移测试")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止主节点")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" stop redis-7000\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 等待 15 秒（cluster-node-timeout），检查从节点是否升主")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" redis-7001 redis-cli cluster nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" master\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"🛠️-四、扩容与管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🛠️-四、扩容与管理"}},[s._v("#")]),s._v(" 🛠️ "),a("strong",[s._v("四、扩容与管理")])]),s._v(" "),a("h4",{attrs:{id:"扩容主节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扩容主节点"}},[s._v("#")]),s._v(" "),a("strong",[s._v("扩容主节点")])]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("新增节点")]),s._v("（例如端口 7006）"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" redis-7006 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7006")]),s._v(":7006 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17006")]),s._v(":17006 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CLUSTER_ANNOUNCE_IP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".17.103 redis:latest "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  redis-server --cluster-enabled "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7006")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])]),s._v(" "),a("li",[a("strong",[s._v("加入集群并分配 Slot")]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加入集群")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" redis-7000 redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cluster")]),s._v(" add-node "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".17.103:7006 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".17.100:7000\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分配 Slot（从其他主节点迁移）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" redis-7000 redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cluster")]),s._v(" reshard "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".17.103:7006 --cluster-from "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("源节点ID"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --cluster-slots "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])]),s._v(" "),a("h4",{attrs:{id:"日常运维"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日常运维"}},[s._v("#")]),s._v(" "),a("strong",[s._v("日常运维")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[a("strong",[s._v("操作")])]),s._v(" "),a("th",[a("strong",[s._v("命令")])])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("节点安全关闭")]),s._v(" "),a("td",[a("code",[s._v("docker stop redis-7000 && docker start redis-7000")])])]),s._v(" "),a("tr",[a("td",[s._v("集群状态检查")]),s._v(" "),a("td",[a("code",[s._v("docker exec -it redis-node1 redis-cli cluster info")])])]),s._v(" "),a("tr",[a("td",[s._v("备份数据")]),s._v(" "),a("td",[s._v("挂载数据卷（"),a("code",[s._v("-v /redis-data:/data")]),s._v("），定期备份持久化文件")])])])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"⚠️-关键配置与避坑指南"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#⚠️-关键配置与避坑指南"}},[s._v("#")]),s._v(" ⚠️ "),a("strong",[s._v("关键配置与避坑指南")])]),s._v(" "),a("ol",[a("li",[a("p",[a("strong",[s._v("网络要求")])]),s._v(" "),a("ul",[a("li",[s._v("节点间需开放"),a("strong",[s._v("客户端端口")]),s._v("（如 6379）和"),a("strong",[s._v("集群总线端口")]),s._v("（+10000，如 16379）。")]),s._v(" "),a("li",[s._v("跨服务器时禁用防火墙或放行端口："),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("firewall-cmd --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7000")]),s._v("-7005"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" firewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--reload")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("配置一致性")])]),s._v(" "),a("ul",[a("li",[s._v("所有节点需启用集群模式："),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[s._v("cluster-enabled yes\ncluster-node-timeout 15000  # 超时时间（毫秒）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[s._v("生产环境务必设置密码："),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[s._v("requirepass yourpassword\nmasterauth yourpassword\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("客户端连接配置")]),s._v("（Spring Boot 示例）")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 172.16.17.100"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7000")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 172.16.17.100"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 172.16.17.101"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 172.16.17.101"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 172.16.17.102"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7004")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 172.16.17.102"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7005")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" yourpassword\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"💎-总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#💎-总结"}},[s._v("#")]),s._v(" 💎 "),a("strong",[s._v("总结")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("单机部署")]),s._v("：适合快速验证，使用 Docker Compose 一键启动。")]),s._v(" "),a("li",[a("strong",[s._v("多机部署")]),s._v("：生产首选，主从跨物理机，通过 "),a("code",[s._v("CLUSTER_ANNOUNCE_IP")]),s._v(" 指定公网 IP。")]),s._v(" "),a("li",[a("strong",[s._v("高可用核心")]),s._v("：Slot 分片存储 + 主从自动故障转移（超时触发选举）。")])]),s._v(" "),a("blockquote",[a("p",[s._v("执行 "),a("code",[s._v("docker-compose up -d")]),s._v(" 后若集群创建失败，检查节点日志：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs redis-node1  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 排查端口冲突或配置错误")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[101],{458:function(v,_,r){"use strict";r.r(_);var e=r(7),l=Object(e.a)({},(function(){var v=this,_=v._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("p",[v._v("ISR（In-Sync Replicas）是 Kafka 中用于保障数据一致性与高可用的核心机制，其数量动态变化且受多因素约束。以下是详细解析：")]),v._v(" "),_("hr"),v._v(" "),_("h3",{attrs:{id:"📌-一、isr-的定义与组成"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#📌-一、isr-的定义与组成"}},[v._v("#")]),v._v(" 📌 "),_("strong",[v._v("一、ISR 的定义与组成")])]),v._v(" "),_("ol",[_("li",[_("p",[_("strong",[v._v("核心概念")])]),v._v(" "),_("ul",[_("li",[_("strong",[v._v("ISR（同步副本集）")]),v._v("：指与分区的 Leader 副本保持数据同步的所有副本集合，"),_("strong",[v._v("包含 Leader 自身")]),v._v("。")]),v._v(" "),_("li",[_("strong",[v._v("AR（Assigned Replicas）")]),v._v("：分区的所有副本（含 Leader 和 Follower）。")]),v._v(" "),_("li",[_("strong",[v._v("OSR（Out-Sync Replicas）")]),v._v("：滞后于 Leader 的副本集合。")]),v._v(" "),_("li",[_("strong",[v._v("关系公式")]),v._v("："),_("code",[v._v("AR = ISR + OSR")]),v._v("。")])])]),v._v(" "),_("li",[_("p",[_("strong",[v._v("同步标准")])]),v._v(" "),_("ul",[_("li",[v._v("Follower 需在 "),_("code",[v._v("replica.lag.time.max.ms")]),v._v("（默认 10 秒）内追上 Leader 的 LEO（Log End Offset，日志末端位移）。")]),v._v(" "),_("li",[v._v("若 Follower 超时未同步，会被移出 ISR 进入 OSR；追平后可重新加入。")])])])]),v._v(" "),_("hr"),v._v(" "),_("h3",{attrs:{id:"🔢-二、isr-的最大数量"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#🔢-二、isr-的最大数量"}},[v._v("#")]),v._v(" 🔢 "),_("strong",[v._v("二、ISR 的最大数量")])]),v._v(" "),_("ol",[_("li",[_("p",[_("strong",[v._v("上限约束")])]),v._v(" "),_("ul",[_("li",[_("strong",[v._v("ISR 最大数量 = 分区的副本数（Replication Factor）")]),v._v("。")]),v._v(" "),_("li",[_("em",[v._v("示例")]),v._v("：若某分区配置副本数=3，则 ISR 最大为 3（Leader + 2 Follower）。")]),v._v(" "),_("li",[_("strong",[v._v("不可超越副本数上限")]),v._v("：副本数受限于 Broker 数量（例如 3 Broker 时副本数≤3）。")])])]),v._v(" "),_("li",[_("p",[_("strong",[v._v("动态变化性")])]),v._v(" "),_("ul",[_("li",[v._v("ISR 数量实际运行时可能小于副本数（如部分 Follower 滞后或宕机）。")]),v._v(" "),_("li",[_("em",[v._v("极端情况")]),v._v("：若所有 Follower 均滞后，ISR 可能仅剩 Leader。")])])])]),v._v(" "),_("hr"),v._v(" "),_("h3",{attrs:{id:"⚙️-三、isr-数量的动态调整机制"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#⚙️-三、isr-数量的动态调整机制"}},[v._v("#")]),v._v(" ⚙️ "),_("strong",[v._v("三、ISR 数量的动态调整机制")])]),v._v(" "),_("ol",[_("li",[_("p",[_("strong",[v._v("Leader 主动维护")])]),v._v(" "),_("ul",[_("li",[v._v("Leader 周期性检查 Follower 同步状态：\n"),_("ul",[_("li",[v._v("使用 "),_("code",[v._v("replica.lag.time.max.ms")]),v._v(" 判断滞后阈值（默认 10 秒）。")]),v._v(" "),_("li",[v._v("若 Follower 超时未拉取数据，移出 ISR；追平后重新加入。")])])]),v._v(" "),_("li",[v._v("通过 ZooKeeper 持久化 ISR 变更记录，并通知集群更新元数据。")])])]),v._v(" "),_("li",[_("p",[_("strong",[v._v("故障场景的影响")])]),v._v(" "),_("ul",[_("li",[_("strong",[v._v("Broker 宕机")]),v._v("：该 Broker 上的副本自动移出 ISR。")]),v._v(" "),_("li",[_("strong",[v._v("Leader 切换")]),v._v("：新 Leader 从剩余 ISR 副本中选举产生，并接管数据同步。")])])])]),v._v(" "),_("hr"),v._v(" "),_("h3",{attrs:{id:"⚠️-四、影响-isr-数量的关键参数"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#⚠️-四、影响-isr-数量的关键参数"}},[v._v("#")]),v._v(" ⚠️ "),_("strong",[v._v("四、影响 ISR 数量的关键参数")])]),v._v(" "),_("ol",[_("li",[_("p",[_("strong",[_("code",[v._v("min.insync.replicas")])])]),v._v(" "),_("ul",[_("li",[_("strong",[v._v("作用")]),v._v("：定义 ISR 中必须保持的最小副本数（含 Leader）。")]),v._v(" "),_("li",[_("em",[v._v("示例")]),v._v("：若设为 2，当 ISR 数量<2 时，生产者写入会抛出异常，牺牲可用性以保数据安全。")]),v._v(" "),_("li",[_("strong",[v._v("建议值")]),v._v("：生产环境通常设为 2（副本数=3 时）。")])])]),v._v(" "),_("li",[_("p",[_("strong",[v._v("生产者 ACK 机制")])]),v._v(" "),_("ul",[_("li",[_("strong",[_("code",[v._v("acks=all")])]),v._v("：需等待 ISR 所有副本写入成功，此时实际参与同步的副本数=当前 ISR 数量。")]),v._v(" "),_("li",[_("strong",[_("code",[v._v("acks=1")])]),v._v("：仅需 Leader 写入成功，与 ISR 数量无关。")])])])]),v._v(" "),_("hr"),v._v(" "),_("h3",{attrs:{id:"💎-总结"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#💎-总结"}},[v._v("#")]),v._v(" 💎 "),_("strong",[v._v("总结")])]),v._v(" "),_("ul",[_("li",[_("strong",[v._v("ISR 是什么")]),v._v("：动态维护的同步副本集（含 Leader），保障数据可靠性与故障转移。")]),v._v(" "),_("li",[_("strong",[v._v("最大数量")]),v._v("：等于分区副本数，受限于 Broker 规模。")]),v._v(" "),_("li",[_("strong",[v._v("数量来源")]),v._v("：由 Leader 基于同步状态（"),_("code",[v._v("replica.lag.time.max.ms")]),v._v("）动态调整，并受 "),_("code",[v._v("min.insync.replicas")]),v._v(" 强约束。")])]),v._v(" "),_("blockquote",[_("p",[_("strong",[v._v("设计本质")]),v._v("：ISR 机制在数据一致性（高副本数）与系统可用性（低副本数容忍）间动态平衡，用户可通过参数按需配置。")])])])}),[],!1,null,null,null);_.default=l.exports}}]);
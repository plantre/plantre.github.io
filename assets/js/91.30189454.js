(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{447:function(a,s,t){"use strict";t.r(s);var e=t(7),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[a._v("基于已有的三台物理机（10.143.143.101-103）和ZooKeeper集群，以下是通过Docker搭建Kafka集群的完整方案：")]),a._v(" "),s("hr"),a._v(" "),s("h3",{attrs:{id:"一、部署架构设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、部署架构设计"}},[a._v("#")]),a._v(" "),s("strong",[a._v("一、部署架构设计")])]),a._v(" "),s("ol",[s("li",[s("p",[s("strong",[a._v("节点分配")])]),a._v(" "),s("ul",[s("li",[a._v("每台物理机部署一个Kafka Broker容器，组成3节点集群。")]),a._v(" "),s("li",[a._v("使用"),s("code",[a._v("host")]),a._v("网络模式（性能最佳）或"),s("code",[a._v("bridge")]),a._v("模式（需端口映射）。")]),a._v(" "),s("li",[a._v("ZooKeeper集群复用现有环境，无需额外部署。")])])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("关键配置原则")])]),a._v(" "),s("ul",[s("li",[s("code",[a._v("KAFKA_BROKER_ID")]),a._v("：每台机器唯一（如101/102/103）。")]),a._v(" "),s("li",[s("code",[a._v("KAFKA_ADVERTISED_LISTENERS")]),a._v("："),s("strong",[a._v("必须设置为宿主机的真实IP")]),a._v("（否则外部客户端无法连接）。")]),a._v(" "),s("li",[s("code",[a._v("KAFKA_ZOOKEEPER_CONNECT")]),a._v("：指向现有ZooKeeper集群地址（如"),s("code",[a._v("zk1:2181,zk2:2181,zk3:2181")]),a._v("）。")])])])]),a._v(" "),s("hr"),a._v(" "),s("h3",{attrs:{id:"二、单台机器部署步骤-以10-143-143-101为例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、单台机器部署步骤-以10-143-143-101为例"}},[a._v("#")]),a._v(" "),s("strong",[a._v("二、单台机器部署步骤（以10.143.143.101为例）")])]),a._v(" "),s("h4",{attrs:{id:"_1-拉取镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-拉取镜像"}},[a._v("#")]),a._v(" "),s("strong",[a._v("1. 拉取镜像")])]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull wurstmeister/kafka\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_2-启动kafka容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动kafka容器"}},[a._v("#")]),a._v(" "),s("strong",[a._v("2. 启动Kafka容器")])]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" kafka101 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--network")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("host")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 推荐host模式避免端口映射问题")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("KAFKA_BROKER_ID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("101")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 与宿主机末三位一致")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("KAFKA_ZOOKEEPER_CONNECT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.143")]),a._v(".143.101:2181,10.143.143.102:2181,10.143.143.103:2181 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 替换为实际ZK地址")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("KAFKA_ADVERTISED_LISTENERS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("PLAINTEXT://10.143.143.101:9092 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 当前宿主机IP")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("KAFKA_LISTENERS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("PLAINTEXT://0.0.0.0:9092 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 容器内监听所有IP")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("KAFKA_LOG_DIRS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/kafka/logs "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 日志目录")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /data/kafka/logs:/kafka/logs "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 挂载日志目录持久化")]),a._v("\n  wurstmeister/kafka\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("blockquote",[s("p",[s("strong",[a._v("参数说明")]),a._v("：")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("KAFKA_BROKER_ID")]),a._v("：集群内唯一标识（102/103机器分别设为102/103）。")]),a._v(" "),s("li",[s("code",[a._v("KAFKA_ADVERTISED_LISTENERS")]),a._v("：客户端使用的通信地址，必须为物理机IP。")]),a._v(" "),s("li",[a._v("若ZooKeeper使用非2181端口，需调整连接字符串。")])])]),a._v(" "),s("h4",{attrs:{id:"_3-重复操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-重复操作"}},[a._v("#")]),a._v(" "),s("strong",[a._v("3. 重复操作")])]),a._v(" "),s("p",[a._v("在"),s("strong",[a._v("102、103机器")]),a._v("执行相同命令，仅修改以下参数：")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("--name kafka102")]),a._v(" / "),s("code",[a._v("kafka103")])]),a._v(" "),s("li",[s("code",[a._v("KAFKA_BROKER_ID=102")]),a._v(" / "),s("code",[a._v("103")])]),a._v(" "),s("li",[s("code",[a._v("KAFKA_ADVERTISED_LISTENERS")]),a._v("中的IP为当前宿主机IP。")])]),a._v(" "),s("hr"),a._v(" "),s("h3",{attrs:{id:"三、集群验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、集群验证"}},[a._v("#")]),a._v(" "),s("strong",[a._v("三、集群验证")])]),a._v(" "),s("h4",{attrs:{id:"_1-创建测试topic"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建测试topic"}},[a._v("#")]),a._v(" "),s("strong",[a._v("1. 创建测试Topic")])]),a._v(" "),s("p",[a._v("进入任意容器执行：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" kafka101 "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /opt/kafka/bin\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建Topic（3分区、3副本）")]),a._v("\n./kafka-topics.sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--create")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  --bootstrap-server "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.143")]),a._v(".143.101:9092 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  --replication-factor "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--partitions")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--topic")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("h4",{attrs:{id:"_2-查看topic状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-查看topic状态"}},[a._v("#")]),a._v(" "),s("strong",[a._v("2. 查看Topic状态")])]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("./kafka-topics.sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--describe")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  --bootstrap-server "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.143")]),a._v(".143.101:9092 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--topic")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[s("strong",[a._v("预期输出")]),a._v("：")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("Partition")]),a._v("信息显示3个分区均匀分布在101/102/103节点。")]),a._v(" "),s("li",[s("code",[a._v("Replicas")]),a._v("显示每个分区有3个副本。")])]),a._v(" "),s("h4",{attrs:{id:"_3-生产消费测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-生产消费测试"}},[a._v("#")]),a._v(" "),s("strong",[a._v("3. 生产消费测试")])]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("生产者")]),a._v("（10.143.143.101）："),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("./kafka-console-producer.sh "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  --broker-list "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.143")]),a._v(".143.101:9092,10.143.143.102:9092,10.143.143.103:9092 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--topic")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])])]),a._v(" "),s("li",[s("strong",[a._v("消费者")]),a._v("（10.143.143.102）："),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("./kafka-console-consumer.sh "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  --bootstrap-server "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.143")]),a._v(".143.101:9092,10.143.143.102:9092,10.143.143.103:9092 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--topic")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  --from-beginning\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),a._v("若生产者输入消息后消费者能实时接收，则集群工作正常。")])]),a._v(" "),s("hr"),a._v(" "),s("h3",{attrs:{id:"四、运维优化建议"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、运维优化建议"}},[a._v("#")]),a._v(" "),s("strong",[a._v("四、运维优化建议")])]),a._v(" "),s("ol",[s("li",[s("p",[s("strong",[a._v("数据持久化")]),s("br"),a._v("\n挂载宿主机目录存储日志（如"),s("code",[a._v("-v /data/kafka:/kafka")]),a._v("），避免容器重启数据丢失。")])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("资源限制")]),s("br"),a._v("\n启动时添加"),s("code",[a._v("--memory=2g --cpus=2")]),a._v("限制容器资源，防止单节点过载。")])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("监控方案")])]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("Kafka Manager")]),a._v("：通过Docker部署可视化管控平台："),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kafka-manager")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" sheepkiller/kafka"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("manager\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"9000:9000"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ZK_HOSTS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"10.143.143.101:2181,10.143.143.102:2181,10.143.143.103:2181"')]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])])])])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("安全加固")])]),a._v(" "),s("ul",[s("li",[a._v("生产环境启用SASL认证（参考的"),s("code",[a._v("KAFKA_CFG_SASL_ENABLED_MECHANISMS")]),a._v("）。")]),a._v(" "),s("li",[a._v("限制ZooKeeper访问IP（如防火墙规则）。")])])])]),a._v(" "),s("hr"),a._v(" "),s("h3",{attrs:{id:"常见问题解决"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见问题解决"}},[a._v("#")]),a._v(" "),s("strong",[a._v("常见问题解决")])]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("Broker无法注册到ZooKeeper")]),a._v("："),s("br"),a._v("\n检查"),s("code",[a._v("KAFKA_ZOOKEEPER_CONNECT")]),a._v("地址是否正确、网络是否互通。")]),a._v(" "),s("li",[s("strong",[a._v("客户端连接超时")]),a._v("："),s("br"),a._v("\n确认"),s("code",[a._v("KAFKA_ADVERTISED_LISTENERS")]),a._v("设置为物理机IP（非localhost）。")]),a._v(" "),s("li",[s("strong",[a._v("数据未持久化")]),a._v("："),s("br"),a._v("\n挂载目录后需确保容器用户有写权限（可添加"),s("code",[a._v("--user root")]),a._v("临时解决）。")])]),a._v(" "),s("blockquote",[s("p",[a._v("部署完成后，建议通过"),s("code",[a._v("kafka-consumer-groups.sh")]),a._v("验证集群负载均衡状态。如需更简化的管理，可改用Docker Compose编排（参考的yml模板）。")])])])}),[],!1,null,null,null);s.default=r.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{452:function(t,v,_){"use strict";_.r(v);var s=_(7),r=Object(s.a)({},(function(){var t=this,v=t._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("p",[t._v("Kafka 中的 "),v("strong",[t._v("Topic（主题）")]),t._v("、"),v("strong",[t._v("Key（键）")]),t._v(" 和 "),v("strong",[t._v("分区（Partition）")]),t._v(" 是核心概念，其关系与数量对应直接影响消息的存储、分发和消费性能。以下是详细解析：")]),t._v(" "),v("hr"),t._v(" "),v("h3",{attrs:{id:"🔍-一、核心关系"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#🔍-一、核心关系"}},[t._v("#")]),t._v(" 🔍 "),v("strong",[t._v("一、核心关系")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[v("strong",[t._v("概念")])]),t._v(" "),v("th",[v("strong",[t._v("作用")])]),t._v(" "),v("th",[v("strong",[t._v("与分区的关系")])])])]),t._v(" "),v("tbody",[v("tr",[v("td",[v("strong",[t._v("Topic")])]),t._v(" "),v("td",[t._v("消息的逻辑分类（如订单、日志）")]),t._v(" "),v("td",[t._v("一个 Topic 可划分为多个分区（Partition），分区是 Topic 的物理存储单元。")])]),t._v(" "),v("tr",[v("td",[v("strong",[t._v("Key")])]),t._v(" "),v("td",[t._v("消息的标识字段（可选）")]),t._v(" "),v("td",[t._v("决定消息分配到哪个分区："),v("br"),t._v(" • 相同 Key 的消息分配到同一分区，保证顺序性。")])]),t._v(" "),v("tr",[v("td",[v("strong",[t._v("Partition")])]),t._v(" "),v("td",[t._v("物理存储单元，分区内消息有序（Offset 递增），分区间无序")]),t._v(" "),v("td",[t._v("分区数量决定 Topic 的并发处理能力和负载均衡能力。")])])])]),t._v(" "),v("blockquote",[v("p",[t._v("✅ "),v("strong",[t._v("关键机制")]),t._v("：")]),t._v(" "),v("ul",[v("li",[v("strong",[t._v("生产者发送消息")]),t._v("：通过 Key 计算分区位置（哈希取模）。")]),t._v(" "),v("li",[v("strong",[t._v("消费者消费消息")]),t._v("：消费者组（Consumer Group）按分区分配消费任务，"),v("strong",[t._v("一个分区同一时刻只能被组内一个消费者消费")]),t._v("。")])])]),t._v(" "),v("hr"),t._v(" "),v("h3",{attrs:{id:"📊-二、数量对应关系"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#📊-二、数量对应关系"}},[t._v("#")]),t._v(" 📊 "),v("strong",[t._v("二、数量对应关系")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[v("strong",[t._v("场景")])]),t._v(" "),v("th",[v("strong",[t._v("数量规则")])]),t._v(" "),v("th",[v("strong",[t._v("影响")])])])]),t._v(" "),v("tbody",[v("tr",[v("td",[v("strong",[t._v("Topic 分区数 vs. 消费者数")])]),t._v(" "),v("td",[t._v("• 分区数 ≥ 消费者数：消费者可并行消费不同分区"),v("br"),t._v(" • 分区数 < 消费者数：部分消费者闲置")]),t._v(" "),v("td",[t._v("消费者数量超过分区数会导致资源浪费。")])]),t._v(" "),v("tr",[v("td",[v("strong",[t._v("Key 与分区分布")])]),t._v(" "),v("td",[t._v("• 相同 Key → 同一分区"),v("br"),t._v(" • 无 Key → 轮询或随机分配分区")]),t._v(" "),v("td",[t._v("Key 设计不当可能导致分区数据倾斜（如大量相同 Key 导致单个分区负载过高）。")])]),t._v(" "),v("tr",[v("td",[v("strong",[t._v("分区数 vs. 集群性能")])]),t._v(" "),v("td",[t._v("分区数 = max(生产吞吐量/单分区生产能力, 消费吞吐量/单分区消费能力)")]),t._v(" "),v("td",[t._v("分区过多增加 Broker 元数据开销，过少限制并发能力。")])])])]),t._v(" "),v("blockquote",[v("p",[t._v("⚠️ "),v("strong",[t._v("分区数量建议")]),t._v("：")]),t._v(" "),v("ul",[v("li",[v("strong",[t._v("经验值")]),t._v("：单 Broker 管理 100-200 个分区（避免文件句柄和内存压力过大）。")]),t._v(" "),v("li",[v("strong",[t._v("基准值")]),t._v("：单分区吞吐约 10MB/s（生产） + 10MB/s（消费）。")])])]),t._v(" "),v("hr"),t._v(" "),v("h3",{attrs:{id:"⚙️-三、默认值配置"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#⚙️-三、默认值配置"}},[t._v("#")]),t._v(" ⚙️ "),v("strong",[t._v("三、默认值配置")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[v("strong",[t._v("配置项")])]),t._v(" "),v("th",[v("strong",[t._v("默认值")])]),t._v(" "),v("th",[v("strong",[t._v("说明")])])])]),t._v(" "),v("tbody",[v("tr",[v("td",[v("strong",[t._v("Topic 分区数")])]),t._v(" "),v("td",[v("code",[t._v("1")])]),t._v(" "),v("td",[t._v("创建 Topic 时未指定分区数则默认为 1。")])]),t._v(" "),v("tr",[v("td",[v("strong",[t._v("Key")])]),t._v(" "),v("td",[v("code",[t._v("null")])]),t._v(" "),v("td",[t._v("生产者发送消息时可不指定 Key，此时采用轮询策略分配分区。")])]),t._v(" "),v("tr",[v("td",[v("strong",[t._v("副本因子（Replication）")])]),t._v(" "),v("td",[v("code",[t._v("1")])]),t._v(" "),v("td",[t._v("每个分区的副本数，默认 1（无冗余），生产环境建议 ≥3。")])]),t._v(" "),v("tr",[v("td",[v("strong",[t._v("生产者分区策略")])]),t._v(" "),v("td",[v("code",[t._v("DefaultPartitioner")])]),t._v(" "),v("td",[t._v("按 Key 哈希或轮询分配分区。")])]),t._v(" "),v("tr",[v("td",[v("strong",[t._v("消费者组 ID")])]),t._v(" "),v("td",[t._v("无默认值（必须手动配置）")]),t._v(" "),v("td",[t._v("消费者组标识，相同组 ID 的消费者共享分区消费任务。")])])])]),t._v(" "),v("blockquote",[v("p",[t._v("💡 "),v("strong",[t._v("示例命令")]),t._v("：创建含 3 分区、2 副本的 Topic")]),t._v(" "),v("div",{staticClass:"language-bash line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[t._v("bin/kafka-topics.sh "),v("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--create")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --bootstrap-server localhost:9092 "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),v("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--topic")]),t._v(" orders "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),v("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--partitions")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("          "),v("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 分区数=3")]),t._v("\n  --replication-factor "),v("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("     "),v("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 副本数=2")]),t._v("\n")])]),t._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[t._v("1")]),v("br"),v("span",{staticClass:"line-number"},[t._v("2")]),v("br"),v("span",{staticClass:"line-number"},[t._v("3")]),v("br"),v("span",{staticClass:"line-number"},[t._v("4")]),v("br"),v("span",{staticClass:"line-number"},[t._v("5")]),v("br")])])]),t._v(" "),v("hr"),t._v(" "),v("h3",{attrs:{id:"⚡-四、设计建议"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#⚡-四、设计建议"}},[t._v("#")]),t._v(" ⚡ "),v("strong",[t._v("四、设计建议")])]),t._v(" "),v("ol",[v("li",[v("strong",[t._v("Key 的使用场景")]),t._v("：\n"),v("ul",[v("li",[v("strong",[t._v("需顺序消费")]),t._v("：相同业务数据（如订单 ID）设置相同 Key。")]),t._v(" "),v("li",[v("strong",[t._v("需负载均衡")]),t._v("：无 Key 或使用复合 Key（如 "),v("code",[t._v("用户ID+时间戳")]),t._v("）。")])])]),t._v(" "),v("li",[v("strong",[t._v("分区扩容")]),t._v("：\n"),v("ul",[v("li",[t._v("Kafka 支持增加分区数（不可减少），但 "),v("strong",[t._v("Key 的分区映射会因数量变化而改变")]),t._v("（需评估顺序性影响）。")])])]),t._v(" "),v("li",[v("strong",[t._v("性能调优")]),t._v("：\n"),v("ul",[v("li",[t._v("监控分区负载，避免倾斜（通过 "),v("code",[t._v("kafka-topics.sh --describe")]),t._v(" 查看分区分布）。")]),t._v(" "),v("li",[t._v("消费者数量与分区数对齐，最大化并发。")])])])]),t._v(" "),v("hr"),t._v(" "),v("h3",{attrs:{id:"💎-总结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#💎-总结"}},[t._v("#")]),t._v(" 💎 "),v("strong",[t._v("总结")])]),t._v(" "),v("blockquote",[v("ul",[v("li",[v("strong",[t._v("Topic")]),t._v("：逻辑消息流，物理划分为多个 "),v("strong",[t._v("分区")]),t._v("。")]),t._v(" "),v("li",[v("strong",[t._v("Key")]),t._v("：控制消息的分区归属，决定顺序性与负载均衡。")]),t._v(" "),v("li",[v("strong",[t._v("默认值")]),t._v("：分区数=1、副本数=1、Key=null（轮询策略）。"),v("br"),t._v("\n合理设计三者的关系是优化 Kafka 吞吐、顺序性和可靠性的关键。")])])])])}),[],!1,null,null,null);v.default=r.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[203],{560:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("æ˜¯çš„ï¼Œ"),t("strong",[s._v("Nginx å¯ä»¥åœ¨ A ä¸»æœºä¸Šå®ç°â€œå°†è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ B çš„ IP é€æ˜ä»£ç†ç»™æœåŠ¡å™¨ Câ€")]),s._v("ï¼Œä¸è¿‡è¯·æ³¨æ„ï¼š")]),s._v(" "),t("blockquote",[t("p",[s._v("âœ… "),t("strong",[s._v("å‰æï¼šA ä¸Šçš„ç¨‹åºæ˜¯ä¸»åŠ¨ä½¿ç”¨ Nginx å‘èµ·è¯·æ±‚")]),s._v("\nâŒ "),t("strong",[s._v("Nginx æ— æ³•æ‹¦æˆªâ€œç³»ç»Ÿå±‚é¢çš„ä»»æ„å‡ºç«™ IP åŒ…â€")]),s._v(" â€”â€” é‚£ä¸ªå¿…é¡»ç”¨ "),t("code",[s._v("iptables")]),s._v("ã€"),t("code",[s._v("ip rule")]),s._v(" æˆ– "),t("code",[s._v("TProxy")]),s._v("ã€‚")])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"âœ…-nginx-èƒ½åšä»€ä¹ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-nginx-èƒ½åšä»€ä¹ˆ"}},[s._v("#")]),s._v(" âœ… Nginx èƒ½åšä»€ä¹ˆï¼Ÿ")]),s._v(" "),t("p",[s._v("Nginx æ˜¯ä¸€ä¸ª"),t("strong",[s._v("åº”ç”¨å±‚ï¼ˆHTTPã€TCPï¼‰åå‘ä»£ç†æœåŠ¡å™¨")]),s._v("ï¼Œå®ƒåªèƒ½å¤„ç†æ˜ç¡®å‘ç»™å®ƒçš„è¯·æ±‚ï¼Œæ¯”å¦‚ï¼š")]),s._v(" "),t("ul",[t("li",[s._v("A ä¸»æœºä¸Šè¿è¡Œçš„æŸä¸ªç¨‹åºï¼Œè¯·æ±‚ "),t("code",[s._v("http://1.2.3.4:80/")]),s._v(" æ—¶ï¼Œæ˜¯"),t("strong",[s._v("é€šè¿‡ Nginx è½¬å‘")])]),s._v(" "),t("li",[s._v("æˆ–è€… A æ˜¯ç½‘å…³ï¼Œå…¶ä»–å®¢æˆ·ç«¯æ˜¾å¼è¯·æ±‚ A çš„ Nginx")])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"âŒ-nginx-ä¸èƒ½åšä»€ä¹ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#âŒ-nginx-ä¸èƒ½åšä»€ä¹ˆ"}},[s._v("#")]),s._v(" âŒ Nginx ä¸èƒ½åšä»€ä¹ˆï¼Ÿ")]),s._v(" "),t("p",[s._v("Nginx "),t("strong",[s._v("æ— æ³•æ¥ç®¡æœ¬æœºä»»æ„ç¨‹åºå¯¹æŸ IP çš„ç›´æ¥è¿æ¥è¯·æ±‚")]),s._v("ï¼Œæ¯”å¦‚ï¼š")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://1.2.3.4/    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿™æ˜¯ç›´æ¥ TCP è¿æ¥ï¼ŒNginx æ— æ³•åŠ«æŒ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿™ç§åŠ«æŒåªæœ‰ "),t("code",[s._v("iptables")]),s._v("ã€"),t("code",[s._v("TProxy")]),s._v("ã€æˆ– "),t("code",[s._v("tun2socks")]),s._v(" è¿™ç±»â€œç³»ç»Ÿçº§â€ç»„ä»¶èƒ½å®Œæˆã€‚")]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"âœ…-nginx-ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹-ä¸»åŠ¨åä»£"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-nginx-ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹-ä¸»åŠ¨åä»£"}},[s._v("#")]),s._v(" âœ… Nginx ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹ï¼ˆä¸»åŠ¨åä»£ï¼‰")]),s._v(" "),t("p",[s._v("å‡è®¾ï¼š")]),s._v(" "),t("ul",[t("li",[s._v("B çš„ IPï¼š"),t("code",[s._v("1.2.3.4")]),s._v("ï¼ˆå·²å®•æœºï¼‰")]),s._v(" "),t("li",[s._v("C çš„ IPï¼š"),t("code",[s._v("5.6.7.8")]),s._v("ï¼ˆèƒ½ç”¨ï¼‰")]),s._v(" "),t("li",[s._v("ä½ å¸Œæœ› "),t("strong",[s._v("Nginx ç›‘å¬ 1.2.3.4:80 çš„è¯·æ±‚")]),s._v("ï¼Œè½¬å‘ç»™ C")])]),s._v(" "),t("p",[s._v("ä½ å¯ä»¥ï¼š")]),s._v(" "),t("h3",{attrs:{id:"æ­¥éª¤-1-åœ¨-a-ä¸Šç»‘å®š-b-çš„-ip-éœ€è¦-root-æƒé™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ­¥éª¤-1-åœ¨-a-ä¸Šç»‘å®š-b-çš„-ip-éœ€è¦-root-æƒé™"}},[s._v("#")]),s._v(" æ­¥éª¤ 1ï¼šåœ¨ A ä¸Šç»‘å®š B çš„ IPï¼ˆéœ€è¦ root æƒé™ï¼‰")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" addr "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v(".3.4 dev eth0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("hr"),s._v(" "),t("h3",{attrs:{id:"æ­¥éª¤-2-é…ç½®-nginx-è½¬å‘"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ­¥éª¤-2-é…ç½®-nginx-è½¬å‘"}},[s._v("#")]),s._v(" æ­¥éª¤ 2ï¼šé…ç½® Nginx è½¬å‘")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" 1.2.3.4:80")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://5.6.7.8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Real-IP "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("hr"),s._v(" "),t("h2",{attrs:{id:"âœ…-æ•´ä½“æµç¨‹å›¾-å¸¦-nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-æ•´ä½“æµç¨‹å›¾-å¸¦-nginx"}},[s._v("#")]),s._v(" âœ… æ•´ä½“æµç¨‹å›¾ï¼ˆå¸¦ Nginxï¼‰ï¼š")]),s._v(" "),t("div",{staticClass:"language-plaintext line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plaintext"}},[t("code",[s._v("å®¢æˆ·ç«¯ï¼ˆè¯·æ±‚ 1.2.3.4ï¼‰ â†’ Aï¼ˆNginxï¼‰ â†’ è½¬å‘è¯·æ±‚åˆ° 5.6.7.8\n                                   â† å“åº”\nâ† å®¢æˆ·ç«¯æ”¶åˆ°å“åº”ï¼ˆä»ç„¶ä»¥ä¸ºæ¥è‡ª 1.2.3.4ï¼‰\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("hr"),s._v(" "),t("h2",{attrs:{id:"ğŸ”-æ€»ç»“å¯¹æ¯”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ”-æ€»ç»“å¯¹æ¯”"}},[s._v("#")]),s._v(" ğŸ” æ€»ç»“å¯¹æ¯”")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("å®ç°æ–¹å¼")]),s._v(" "),t("th",[s._v("èƒ½å¦é€æ˜æ‹¦æˆª")]),s._v(" "),t("th",[s._v("æ˜¯å¦ä¿®æ”¹å†…æ ¸")]),s._v(" "),t("th",[s._v("ä¼˜åŠ¿")]),s._v(" "),t("th",[s._v("é€‚ç”¨åœºæ™¯")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[t("code",[s._v("iptables + DNAT")])]),s._v(" "),t("td",[s._v("âœ… æ˜¯")]),s._v(" "),t("td",[s._v("â— æ˜¯")]),s._v(" "),t("td",[s._v("é€æ˜æ¥ç®¡æ‰€æœ‰è¯·æ±‚")]),s._v(" "),t("td",[t("strong",[s._v("ç³»ç»Ÿçº§æ¥ç®¡ï¼ˆæ¨èï¼‰")])])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("nginx åå‘ä»£ç†")])]),s._v(" "),t("td",[s._v("âŒ å¦")]),s._v(" "),t("td",[s._v("âŒ å¦")]),s._v(" "),t("td",[s._v("é…ç½®ç®€å•ï¼ŒHTTP æ”¯æŒå¼º")]),s._v(" "),t("td",[s._v("ä¸»åŠ¨ä½¿ç”¨ nginx ä½œä¸ºä»£ç†æ—¶")])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("TProxy")]),s._v(" / "),t("code",[s._v("redsocks")])]),s._v(" "),t("td",[s._v("âœ… æ˜¯")]),s._v(" "),t("td",[s._v("â— æ˜¯")]),s._v(" "),t("td",[s._v("TCP/UDP å…¨é¢æ¥ç®¡")]),s._v(" "),t("td",[s._v("é«˜çº§ç½‘ç»œæ¥ç®¡éœ€æ±‚")])])])]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("å¦‚æœä½ å¸Œæœ›å°† "),t("strong",[s._v("æœ¬æœºä¸Šä»»æ„ç¨‹åºè®¿é—® 1.2.3.4 çš„è¯·æ±‚ï¼Œå…¨éƒ¨è‡ªåŠ¨èµ° C")]),s._v("ï¼Œ"),t("strong",[s._v("å¿…é¡»ç”¨ "),t("code",[s._v("iptables")]),s._v(" è½¬å‘")]),s._v("ã€‚\nä½†å¦‚æœä½ èƒ½æ§åˆ¶è¯·æ±‚çš„æºå¤´ï¼Œè®©å®ƒèµ° Nginxï¼Œå°±å¯ä»¥ç”¨åä»£ã€‚")]),s._v(" "),t("p",[s._v("ä½ æ›´å€¾å‘äºå“ªç§ï¼Ÿæ˜¯å¦æˆ‘æ¥å¸®ä½ å†™å®Œæ•´çš„æ–¹æ¡ˆè„šæœ¬ï¼Ÿ")])])}),[],!1,null,null,null);t.default=e.exports}}]);
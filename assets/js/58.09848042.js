(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{415:function(s,t,v){"use strict";v.r(t);var _=v(7),a=Object(_.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h3",{attrs:{id:"redis-槽-slot-详解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-槽-slot-详解"}},[s._v("#")]),s._v(" "),t("strong",[s._v("Redis 槽（Slot）详解")])]),s._v(" "),t("p",[s._v("Redis Cluster 使用 "),t("strong",[s._v("哈希槽（Hash Slot）")]),s._v(" 机制来分片（Sharding）数据，这是其实现分布式数据存储的核心设计。以下是关键概念解析：")]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"_1-什么是槽-slot"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是槽-slot"}},[s._v("#")]),s._v(" "),t("strong",[s._v("1. 什么是槽（Slot）？")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("定义")]),s._v("：Redis Cluster 将整个数据集划分为 "),t("strong",[s._v("16384 个槽")]),s._v("（编号 "),t("code",[s._v("0-16383")]),s._v("），每个键通过哈希计算映射到其中一个槽。")]),s._v(" "),t("li",[t("strong",[s._v("作用")]),s._v("：\n"),t("ul",[t("li",[s._v("数据分片：不同槽的数据存储在不同的主节点上。")]),s._v(" "),t("li",[s._v("负载均衡：槽均匀分布，避免单节点压力过大。")]),s._v(" "),t("li",[s._v("动态扩缩容：通过迁移槽实现节点增减。")])])])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"_2-槽如何分配"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-槽如何分配"}},[s._v("#")]),s._v(" "),t("strong",[s._v("2. 槽如何分配？")])]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("默认规则")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("集群初始化时，16384 个槽会 "),t("strong",[s._v("均匀分配")]),s._v(" 给所有主节点。")]),s._v(" "),t("li",[s._v("例如：3 个主节点，每个节点大约负责 "),t("code",[s._v("5461")]),s._v(" 个槽：\n"),t("ul",[t("li",[s._v("节点A："),t("code",[s._v("0-5460")])]),s._v(" "),t("li",[s._v("节点B："),t("code",[s._v("5461-10922")])]),s._v(" "),t("li",[s._v("节点C："),t("code",[s._v("10923-16383")])])])])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("查看槽分配")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.143")]),s._v(".143.101 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7000")]),s._v(" CLUSTER SLOTS\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("输出示例：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('1) 1) (integer) 0          # 起始槽\n   2) (integer) 5460       # 结束槽\n   3) 1) "10.143.143.101"  # 主节点IP\n      2) (integer) 7000    # 主节点端口\n   4) 1) "10.143.143.102"  # 从节点IP\n      2) (integer) 7003    # 从节点端口\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"_3-键如何映射到槽"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-键如何映射到槽"}},[s._v("#")]),s._v(" "),t("strong",[s._v("3. 键如何映射到槽？")])]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("计算公式")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("slot "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" CRC16"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[t("code",[s._v("CRC16")]),s._v(" 是 Redis 使用的哈希算法。")]),s._v(" "),t("li",[s._v("例如：键 "),t("code",[s._v("user:100")]),s._v(" 的哈希值模 "),t("code",[s._v("16384")]),s._v(" 决定它属于哪个槽。")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("手动计算槽")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.143")]),s._v(".143.101 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7000")]),s._v(" CLUSTER KEYSLOT "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user:100"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("输出：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("(integer) 14982  # 该键属于槽 14982\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"_4-槽的迁移与平衡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-槽的迁移与平衡"}},[s._v("#")]),s._v(" "),t("strong",[s._v("4. 槽的迁移与平衡")])]),s._v(" "),t("h3",{attrs:{id:"_1-为什么需要迁移槽"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-为什么需要迁移槽"}},[s._v("#")]),s._v(" "),t("strong",[s._v("（1）为什么需要迁移槽？")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("扩容")]),s._v("：新增主节点时，需从其他节点转移部分槽给它。")]),s._v(" "),t("li",[t("strong",[s._v("缩容")]),s._v("：删除主节点前，需将其负责的槽迁移到其他节点。")]),s._v(" "),t("li",[t("strong",[s._v("负载均衡")]),s._v("：某些节点负载过高时，手动调整槽分布。")])]),s._v(" "),t("h3",{attrs:{id:"_2-手动迁移槽"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-手动迁移槽"}},[s._v("#")]),s._v(" "),t("strong",[s._v("（2）手动迁移槽")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cluster")]),s._v(" reshard "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.143")]),s._v(".143.101:7000\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("交互流程：")]),s._v(" "),t("ol",[t("li",[s._v("输入要迁移的槽数量（如 "),t("code",[s._v("1000")]),s._v("）。")]),s._v(" "),t("li",[s._v("输入目标节点ID（接收槽的节点）。")]),s._v(" "),t("li",[s._v("输入源节点ID（"),t("code",[s._v("all")]),s._v(" 表示从所有节点抽取，或指定单个节点）。")]),s._v(" "),t("li",[s._v("确认迁移。")])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"_5-槽-vs-一致性哈希"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-槽-vs-一致性哈希"}},[s._v("#")]),s._v(" "),t("strong",[s._v("5. 槽 vs. 一致性哈希")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("特性")]),s._v(" "),t("th",[s._v("Redis 槽")]),s._v(" "),t("th",[s._v("一致性哈希（如 Twemproxy）")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[t("strong",[s._v("分片粒度")])]),s._v(" "),t("td",[s._v("固定 16384 槽")]),s._v(" "),t("td",[s._v("虚拟节点（通常更多）")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("动态扩缩容")])]),s._v(" "),t("td",[s._v("需手动迁移槽")]),s._v(" "),t("td",[s._v("自动重新哈希，但数据可能丢失")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("数据均衡")])]),s._v(" "),t("td",[s._v("槽均匀分配，强制均衡")]),s._v(" "),t("td",[s._v("依赖哈希函数，可能不均匀")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("复杂度")])]),s._v(" "),t("td",[s._v("高（需管理槽分配）")]),s._v(" "),t("td",[s._v("低（客户端透明）")])])])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"_6-关键注意事项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-关键注意事项"}},[s._v("#")]),s._v(" "),t("strong",[s._v("6. 关键注意事项")])]),s._v(" "),t("ol",[t("li",[t("p",[t("strong",[s._v("槽覆盖所有数据")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("集群必须分配完所有 "),t("code",[s._v("16384")]),s._v(" 个槽，否则部分数据无法读写。")]),s._v(" "),t("li",[s._v("检查未分配槽："),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cluster")]),s._v(" check "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.143")]),s._v(".143.101:7000 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\[ERR\\]"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("避免单点故障")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("每个主节点应有至少一个从节点（复制其槽数据）。")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("客户端重定向")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("如果客户端访问错误的节点，会收到 "),t("code",[s._v("MOVED")]),s._v(" 或 "),t("code",[s._v("ASK")]),s._v(" 响应，需支持自动跳转。")])])])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"_7-示例-3主3从集群的槽分配"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-示例-3主3从集群的槽分配"}},[s._v("#")]),s._v(" "),t("strong",[s._v("7. 示例：3主3从集群的槽分配")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("主节点")]),s._v(" "),t("th",[s._v("从节点")]),s._v(" "),t("th",[s._v("槽范围")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[t("code",[s._v("10.143.143.101:7000")])]),s._v(" "),t("td",[t("code",[s._v("10.143.143.102:7003")])]),s._v(" "),t("td",[t("code",[s._v("0-5460")])])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("10.143.143.102:7002")])]),s._v(" "),t("td",[t("code",[s._v("10.143.143.103:7005")])]),s._v(" "),t("td",[t("code",[s._v("5461-10922")])])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("10.143.143.103:7004")])]),s._v(" "),t("td",[t("code",[s._v("10.143.143.101:7001")])]),s._v(" "),t("td",[t("code",[s._v("10923-16383")])])])])]),s._v(" "),t("hr"),s._v(" "),t("h3",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" "),t("strong",[s._v("总结")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("槽是 Redis Cluster 分片的基本单位")]),s._v("，共 "),t("code",[s._v("16384")]),s._v(" 个。")]),s._v(" "),t("li",[t("strong",[s._v("键通过哈希映射到槽")]),s._v("，槽再绑定到具体节点。")]),s._v(" "),t("li",[t("strong",[s._v("扩缩容需手动迁移槽")]),s._v("，但可通过工具（如 "),t("code",[s._v("redis-cli --cluster rebalance")]),s._v("）辅助。")]),s._v(" "),t("li",[t("strong",[s._v("设计目标")]),s._v("：在数据分片和负载均衡之间取得平衡，同时支持动态调整。")])])])}),[],!1,null,null,null);t.default=a.exports}}]);
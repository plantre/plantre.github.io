(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{433:function(_,v,t){"use strict";t.r(v);var r=t(7),o=Object(r.a)({},(function(){var _=this,v=_._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("p",[_._v("Seata 作为主流的分布式事务解决方案，支持以下四种事务模式，覆盖不同业务场景的需求：")]),_._v(" "),v("hr"),_._v(" "),v("h3",{attrs:{id:"🔧-1-at-模式-auto-transaction"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#🔧-1-at-模式-auto-transaction"}},[_._v("#")]),_._v(" 🔧 "),v("strong",[_._v("1. AT 模式（Auto Transaction）")])]),_._v(" "),v("p",[v("strong",[_._v("原理")]),_._v("：基于二阶段提交（2PC）优化，通过 "),v("strong",[_._v("SQL 解析 + 回滚日志")]),_._v(" 实现自动补偿，业务侵入性低。"),v("br"),_._v(" "),v("strong",[_._v("工作流程")]),_._v("：")]),_._v(" "),v("ol",[v("li",[v("strong",[_._v("一阶段")]),_._v("：\n"),v("ul",[v("li",[_._v("解析业务 SQL，生成前置快照（Before Image）和业务操作后的快照（After Image）。")]),_._v(" "),v("li",[_._v("将快照存入 "),v("code",[_._v("undo_log")]),_._v(" 表，与业务 SQL 在同一本地事务中提交。")])])]),_._v(" "),v("li",[v("strong",[_._v("二阶段")]),_._v("：\n"),v("ul",[v("li",[v("strong",[_._v("提交")]),_._v("：异步删除 "),v("code",[_._v("undo_log")]),_._v(" 日志。")]),_._v(" "),v("li",[v("strong",[_._v("回滚")]),_._v("：根据 "),v("code",[_._v("undo_log")]),_._v(" 生成反向 SQL 补偿数据。"),v("br"),_._v(" "),v("strong",[_._v("适用场景")]),_._v("：")])])])]),_._v(" "),v("ul",[v("li",[_._v("常规业务（如订单创建、库存扣减），需快速接入分布式事务。"),v("br"),_._v(" "),v("strong",[_._v("优点")]),_._v("：")]),_._v(" "),v("li",[_._v("业务无侵入，仅需配置代理数据源。"),v("br"),_._v(" "),v("strong",[_._v("缺点")]),_._v("：")]),_._v(" "),v("li",[_._v("依赖数据库行锁，高并发下可能阻塞（如热点数据更新）。")])]),_._v(" "),v("hr"),_._v(" "),v("h3",{attrs:{id:"⚙️-2-tcc-模式-try-confirm-cancel"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#⚙️-2-tcc-模式-try-confirm-cancel"}},[_._v("#")]),_._v(" ⚙️ "),v("strong",[_._v("2. TCC 模式（Try-Confirm-Cancel）")])]),_._v(" "),v("p",[v("strong",[_._v("原理")]),_._v("：通过 "),v("strong",[_._v("业务编码")]),_._v(" 实现两阶段，需手动编写三个阶段方法：")]),_._v(" "),v("ul",[v("li",[v("strong",[_._v("Try")]),_._v("：资源预留（如冻结库存、预扣余额）。")]),_._v(" "),v("li",[v("strong",[_._v("Confirm")]),_._v("：执行实际业务（如扣减冻结资源）。")]),_._v(" "),v("li",[v("strong",[_._v("Cancel")]),_._v("：释放预留资源（如解冻库存）。"),v("br"),_._v(" "),v("strong",[_._v("关键要求")]),_._v("：")]),_._v(" "),v("li",[_._v("Confirm/Cancel 需保证 "),v("strong",[_._v("幂等性")]),_._v("（网络重试可能导致重复调用）。")]),_._v(" "),v("li",[_._v("需处理 "),v("strong",[_._v("三大异常")]),_._v("：\n"),v("ul",[v("li",[v("strong",[_._v("空回滚")]),_._v("：未执行 Try 时触发 Cancel（需检查事务记录）。")]),_._v(" "),v("li",[v("strong",[_._v("幂等")]),_._v("：重复调用 Confirm/Cancel 需返回相同结果。")]),_._v(" "),v("li",[v("strong",[_._v("悬挂")]),_._v("：Cancel 在 Try 前执行（需事务状态记录）。"),v("br"),_._v(" "),v("strong",[_._v("适用场景")]),_._v("：")])])]),_._v(" "),v("li",[_._v("高性能需求（如支付、秒杀），或需强隔离性的金融业务。"),v("br"),_._v(" "),v("strong",[_._v("优点")]),_._v("：")]),_._v(" "),v("li",[_._v("无全局锁，性能优于 AT 模式。"),v("br"),_._v(" "),v("strong",[_._v("缺点")]),_._v("：")]),_._v(" "),v("li",[_._v("代码侵入性强，需为每个业务编写三阶段逻辑。")])]),_._v(" "),v("hr"),_._v(" "),v("h3",{attrs:{id:"🔄-3-saga-模式"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#🔄-3-saga-模式"}},[_._v("#")]),_._v(" 🔄 "),v("strong",[_._v("3. SAGA 模式")])]),_._v(" "),v("p",[v("strong",[_._v("原理")]),_._v("："),v("strong",[_._v("长事务拆分")]),_._v("为多个本地事务，通过 "),v("strong",[_._v("补偿操作")]),_._v(" 实现最终一致性。"),v("br"),_._v(" "),v("strong",[_._v("实现方式")]),_._v("：")]),_._v(" "),v("ul",[v("li",[v("strong",[_._v("编排式（Orchestration）")]),_._v("：\n"),v("ul",[v("li",[_._v("中央协调器（如 Seata 状态机）控制流程，依次调用服务。")])])]),_._v(" "),v("li",[v("strong",[_._v("协同式（Choreography）")]),_._v("：\n"),v("ul",[v("li",[_._v("服务间通过 "),v("strong",[_._v("事件驱动")]),_._v("（如消息队列）触发后续操作。"),v("br"),_._v(" "),v("strong",[_._v("工作流程")]),_._v("：")])])]),_._v(" "),v("li",[_._v("若某步骤失败，按 "),v("strong",[_._v("逆序触发补偿操作")]),_._v("（如订单取消 → 库存恢复）。"),v("br"),_._v(" "),v("strong",[_._v("适用场景")]),_._v("：")]),_._v(" "),v("li",[_._v("跨服务长流程（如电商下单、保险理赔），支持异步执行。"),v("br"),_._v(" "),v("strong",[_._v("优点")]),_._v("：")]),_._v(" "),v("li",[_._v("支持复杂业务流程，无阻塞问题。"),v("br"),_._v(" "),v("strong",[_._v("缺点")]),_._v("：")]),_._v(" "),v("li",[_._v("补偿逻辑复杂，需保证 "),v("strong",[_._v("最终一致性")]),_._v("。")])]),_._v(" "),v("hr"),_._v(" "),v("h3",{attrs:{id:"🗂️-4-xa-模式"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#🗂️-4-xa-模式"}},[_._v("#")]),_._v(" 🗂️ "),v("strong",[_._v("4. XA 模式")])]),_._v(" "),v("p",[v("strong",[_._v("原理")]),_._v("：基于数据库的 "),v("strong",[_._v("标准两阶段提交（2PC）")]),_._v("，由事务管理器（TM）协调资源管理器（RM）。")]),_._v(" "),v("ul",[v("li",[v("strong",[_._v("一阶段（Prepare）")]),_._v("：各参与者预提交并锁定资源。")]),_._v(" "),v("li",[v("strong",[_._v("二阶段（Commit/Rollback）")]),_._v("：协调者根据一阶段结果通知提交或回滚。"),v("br"),_._v(" "),v("strong",[_._v("适用场景")]),_._v("：")]),_._v(" "),v("li",[_._v("强依赖数据库事务协议的传统系统（如银行转账）。"),v("br"),_._v(" "),v("strong",[_._v("优点")]),_._v("：")]),_._v(" "),v("li",[_._v("强一致性保证，兼容支持 XA 协议的数据库（如 MySQL、Oracle）。"),v("br"),_._v(" "),v("strong",[_._v("缺点")]),_._v("：")]),_._v(" "),v("li",[_._v("性能低（同步阻塞），协调者单点故障风险。")])]),_._v(" "),v("hr"),_._v(" "),v("h3",{attrs:{id:"💎-模式对比与选型建议"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#💎-模式对比与选型建议"}},[_._v("#")]),_._v(" 💎 "),v("strong",[_._v("模式对比与选型建议")])]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[v("strong",[_._v("模式")])]),_._v(" "),v("th",[v("strong",[_._v("一致性")])]),_._v(" "),v("th",[v("strong",[_._v("侵入性")])]),_._v(" "),v("th",[v("strong",[_._v("性能")])]),_._v(" "),v("th",[v("strong",[_._v("适用场景")])])])]),_._v(" "),v("tbody",[v("tr",[v("td",[v("strong",[_._v("AT")])]),_._v(" "),v("td",[_._v("最终一致")]),_._v(" "),v("td",[_._v("无")]),_._v(" "),v("td",[_._v("中（有锁阻塞）")]),_._v(" "),v("td",[_._v("常规业务（订单、库存）")])]),_._v(" "),v("tr",[v("td",[v("strong",[_._v("TCC")])]),_._v(" "),v("td",[_._v("最终一致")]),_._v(" "),v("td",[_._v("高")]),_._v(" "),v("td",[_._v("高")]),_._v(" "),v("td",[_._v("高并发、金融交易")])]),_._v(" "),v("tr",[v("td",[v("strong",[_._v("SAGA")])]),_._v(" "),v("td",[_._v("最终一致")]),_._v(" "),v("td",[_._v("中")]),_._v(" "),v("td",[_._v("高（异步）")]),_._v(" "),v("td",[_._v("长流程、跨服务业务")])]),_._v(" "),v("tr",[v("td",[v("strong",[_._v("XA")])]),_._v(" "),v("td",[_._v("强一致")]),_._v(" "),v("td",[_._v("低")]),_._v(" "),v("td",[_._v("低")]),_._v(" "),v("td",[_._v("传统数据库强一致需求")])])])]),_._v(" "),v("blockquote",[v("p",[v("strong",[_._v("选型原则")]),_._v("：")]),_._v(" "),v("ul",[v("li",[_._v("追求低侵入 → "),v("strong",[_._v("AT 模式")])]),_._v(" "),v("li",[_._v("追求高性能 → "),v("strong",[_._v("TCC 模式")])]),_._v(" "),v("li",[_._v("流程复杂且长 → "),v("strong",[_._v("SAGA 模式")])]),_._v(" "),v("li",[_._v("强一致性需求 → "),v("strong",[_._v("XA 模式")])])])]),_._v(" "),v("hr"),_._v(" "),v("h3",{attrs:{id:"⚠️-生产注意事项"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#⚠️-生产注意事项"}},[_._v("#")]),_._v(" ⚠️ "),v("strong",[_._v("生产注意事项")])]),_._v(" "),v("ol",[v("li",[v("strong",[_._v("幂等设计")]),_._v("：TCC/SAGA 的 Confirm/Cancel 需支持重复调用。")]),_._v(" "),v("li",[v("strong",[_._v("隔离性补偿")]),_._v("：AT 模式可能脏读，可通过 "),v("code",[_._v("SELECT FOR UPDATE")]),_._v(" 强制读已提交。")]),_._v(" "),v("li",[v("strong",[_._v("监控与日志")]),_._v("：使用 Seata Dashboard 跟踪全局事务状态。")])]),_._v(" "),v("blockquote",[v("p",[_._v("参考官方文档："),v("a",{attrs:{href:"https://seata.io/zh-cn/docs/user/mode.html",target:"_blank",rel:"noopener noreferrer"}},[_._v("Seata 事务模式详解"),v("OutboundLink")],1),_._v("。")])])])}),[],!1,null,null,null);v.default=o.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{419:function(s,a,e){"use strict";e.r(a);var t=e(7),r=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("Quest:")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("b5d8e5dcc0d0e23082cf67bb6c9f4b0f04de733d "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.143")]),s._v(".143.101:7000@17000 master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1750212640496")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" connected\n9571af7c0cf7ed34d92a80a8b83cbaf0d613c58f "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.143")]),s._v(".143.102:7002@17002 myself,master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" connected "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v("-10922\n125cb6931175545975c72f8d753e4956595976b1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.143")]),s._v(".143.102:7003@17003 master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1750212641000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" connected "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-5460\n1746b54730d4eb896616c3d45950975030adb739 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.143")]),s._v(".143.103:7005@17005 slave 9571af7c0cf7ed34d92a80a8b83cbaf0d613c58f "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1750212641503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" connected\n3bafc48b6d698674a51865bdab6be91a33aecb41 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.143")]),s._v(".143.101:7001@17001 master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1750212642000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" connected\nad2e7ec8c7f9e7d5c5cd36463d467e90ce57948f "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.143")]),s._v(".143.103:7004@17004 master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1750212642511")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" connected "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),s._v("-16383，把10.143.143.102:7003的槽分配到主节点10.143.143.101:7000，10.143.143.102:7002和10.143.143.103:7004保持不变，其他三个节点都变为从节点，并且主从不在一台机器上\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"最终目标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最终目标"}},[s._v("#")]),s._v(" "),a("strong",[s._v("最终目标")])]),s._v(" "),a("p",[s._v("根据你的需求，调整后的集群结构如下：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[a("strong",[s._v("主节点")])]),s._v(" "),a("th",[a("strong",[s._v("从节点")])]),s._v(" "),a("th",[a("strong",[s._v("槽分配")])]),s._v(" "),a("th",[a("strong",[s._v("规则")])])])]),s._v(" "),a("tbody",[a("tr",[a("td",[a("code",[s._v("10.143.143.101:7000")])]),s._v(" "),a("td",[a("code",[s._v("10.143.143.102:7003")])]),s._v(" "),a("td",[a("code",[s._v("0-5460")])]),s._v(" "),a("td",[s._v("主从不在同一台机器")])]),s._v(" "),a("tr",[a("td",[a("code",[s._v("10.143.143.102:7002")])]),s._v(" "),a("td",[a("code",[s._v("10.143.143.103:7005")])]),s._v(" "),a("td",[a("code",[s._v("5461-10922")])]),s._v(" "),a("td",[s._v("主从不在同一台机器")])]),s._v(" "),a("tr",[a("td",[a("code",[s._v("10.143.143.103:7004")])]),s._v(" "),a("td",[a("code",[s._v("10.143.143.101:7001")])]),s._v(" "),a("td",[a("code",[s._v("10923-16383")])]),s._v(" "),a("td",[s._v("主从不在同一台机器")])])])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"操作步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作步骤"}},[s._v("#")]),s._v(" "),a("strong",[s._v("操作步骤")])]),s._v(" "),a("h4",{attrs:{id:"_1-将-10-143-143-102-7003-的槽-0-5460-迁移到-10-143-143-101-7000"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-将-10-143-143-102-7003-的槽-0-5460-迁移到-10-143-143-101-7000"}},[s._v("#")]),s._v(" "),a("strong",[s._v("1. 将 "),a("code",[s._v("10.143.143.102:7003")]),s._v(" 的槽（0-5460）迁移到 "),a("code",[s._v("10.143.143.101:7000")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cluster")]),s._v(" reshard "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.143")]),s._v(".143.101:7000\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("输入以下信息：")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("迁移的槽数量")]),s._v("："),a("code",[s._v("5461")]),s._v("（因为 "),a("code",[s._v("0-5460")]),s._v(" 共5461个槽）")]),s._v(" "),a("li",[a("strong",[s._v("目标节点ID")]),s._v("："),a("code",[s._v("b5d8e5dcc0d0e23082cf67bb6c9f4b0f04de733d")]),s._v("（7000的节点ID）")]),s._v(" "),a("li",[a("strong",[s._v("源节点ID")]),s._v("："),a("code",[s._v("125cb6931175545975c72f8d753e4956595976b1")]),s._v("（7003的节点ID）")]),s._v(" "),a("li",[s._v("输入 "),a("code",[s._v("done")]),s._v(" 完成迁移。")])]),s._v(" "),a("h4",{attrs:{id:"_2-将-10-143-143-102-7003-从主节点降级为从节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-将-10-143-143-102-7003-从主节点降级为从节点"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2. 将 "),a("code",[s._v("10.143.143.102:7003")]),s._v(" 从主节点降级为从节点")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接到 7003 执行")]),s._v("\nredis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.143")]),s._v(".143.102 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v(" CLUSTER REPLICATE b5d8e5dcc0d0e23082cf67bb6c9f4b0f04de733d\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("（"),a("code",[s._v("b5d8...")]),s._v(" 是 "),a("code",[s._v("7000")]),s._v(" 的节点ID）")]),s._v(" "),a("h4",{attrs:{id:"_3-将-10-143-143-101-7001-从主节点降级为从节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-将-10-143-143-101-7001-从主节点降级为从节点"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3. 将 "),a("code",[s._v("10.143.143.101:7001")]),s._v(" 从主节点降级为从节点")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接到 7001 执行")]),s._v("\nredis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.143")]),s._v(".143.101 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" CLUSTER REPLICATE ad2e7ec8c7f9e7d5c5cd36463d467e90ce57948f\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("（"),a("code",[s._v("ad2e...")]),s._v(" 是 "),a("code",[s._v("7004")]),s._v(" 的节点ID）")]),s._v(" "),a("h4",{attrs:{id:"_4-确保-10-143-143-103-7005-复制-7002"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-确保-10-143-143-103-7005-复制-7002"}},[s._v("#")]),s._v(" "),a("strong",[s._v("4. 确保 "),a("code",[s._v("10.143.143.103:7005")]),s._v(" 复制 "),a("code",[s._v("7002")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接到 7005 执行")]),s._v("\nredis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.143")]),s._v(".143.103 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7005")]),s._v(" CLUSTER REPLICATE 9571af7c0cf7ed34d92a80a8b83cbaf0d613c58f\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("（"),a("code",[s._v("9571...")]),s._v(" 是 "),a("code",[s._v("7002")]),s._v(" 的节点ID）")]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"验证集群状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证集群状态"}},[s._v("#")]),s._v(" "),a("strong",[s._v("验证集群状态")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cluster")]),s._v(" check "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.143")]),s._v(".143.101:7000\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("预期输出")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("10.143.143.101:7000 (b5d8e5dc...) -> 0-5460 (主)\n   └─ 10.143.143.102:7003 (从, 跨机器)\n10.143.143.102:7002 (9571af7c...) -> 5461-10922 (主)\n   └─ 10.143.143.103:7005 (从, 跨机器)\n10.143.143.103:7004 (ad2e7ec8...) -> 10923-16383 (主)\n   └─ 10.143.143.101:7001 (从, 跨机器)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("hr"),s._v(" "),a("h3",{attrs:{id:"关键点总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关键点总结"}},[s._v("#")]),s._v(" "),a("strong",[s._v("关键点总结")])]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("槽迁移")]),s._v("：将 "),a("code",[s._v("7003")]),s._v(" 的槽 "),a("code",[s._v("0-5460")]),s._v(" 迁移到 "),a("code",[s._v("7000")]),s._v("。")]),s._v(" "),a("li",[a("strong",[s._v("主从分离")]),s._v("：\n"),a("ul",[a("li",[a("code",[s._v("7003")]),s._v(" 复制 "),a("code",[s._v("7000")]),s._v("（跨机器：102 → 101）")]),s._v(" "),a("li",[a("code",[s._v("7001")]),s._v(" 复制 "),a("code",[s._v("7004")]),s._v("（跨机器：101 → 103）")]),s._v(" "),a("li",[a("code",[s._v("7005")]),s._v(" 复制 "),a("code",[s._v("7002")]),s._v("（跨机器：103 → 102）")])])]),s._v(" "),a("li",[a("strong",[s._v("高可用保障")]),s._v("：任意一台机器宕机，集群仍能正常工作。")])]),s._v(" "),a("p",[s._v("如果有其他问题，可以随时提供 "),a("code",[s._v("CLUSTER NODES")]),s._v(" 的最新输出进一步调试！")])])}),[],!1,null,null,null);a.default=r.exports}}]);
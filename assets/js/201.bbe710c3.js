(window.webpackJsonp=window.webpackJsonp||[]).push([[201],{558:function(a,s,t){"use strict";t.r(s);var r=t(7),e=Object(r.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[a._v("是的，"),s("strong",[a._v("在客户端 A 上修改路由表，确实可以实现让它发往服务器 B 的请求实际流向服务器 C")]),a._v("，"),s("strong",[a._v("前提是你对 A 有控制权（例如你能 SSH 登录 A 或修改其系统配置）")]),a._v("。")]),a._v(" "),s("hr"),a._v(" "),s("h2",{attrs:{id:"✅-原理解释"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-原理解释"}},[a._v("#")]),a._v(" ✅ 原理解释")]),a._v(" "),s("p",[a._v("你可以在 A 主机上配置静态路由或 NAT 规则，让：")]),a._v(" "),s("ul",[s("li",[a._v("目标为 "),s("strong",[a._v("B 的 IP")]),a._v(" 的数据包")]),a._v(" "),s("li",[a._v("被 "),s("strong",[a._v("重定向或伪装")]),a._v(" 发往服务器 C 的 IP")])]),a._v(" "),s("p",[a._v("这叫做 "),s("strong",[a._v("策略路由或 NAT 映射")]),a._v("。")]),a._v(" "),s("hr"),a._v(" "),s("h2",{attrs:{id:"✅-实现方法-以-linux-为例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-实现方法-以-linux-为例"}},[a._v("#")]),a._v(" ✅ 实现方法（以 Linux 为例）")]),a._v(" "),s("p",[a._v("假设：")]),a._v(" "),s("ul",[s("li",[a._v("B 的公网 IP 是："),s("code",[a._v("1.2.3.4")])]),a._v(" "),s("li",[a._v("C 的公网 IP 是："),s("code",[a._v("5.6.7.8")])]),a._v(" "),s("li",[a._v("A 是一台 Linux 服务器，你有 root 权限")])]),a._v(" "),s("hr"),a._v(" "),s("h3",{attrs:{id:"方法-1-iptables-本地-snat-dnat-转发到-c"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方法-1-iptables-本地-snat-dnat-转发到-c"}},[a._v("#")]),a._v(" 方法 1：iptables 本地 SNAT + DNAT 转发到 C")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启用 IP 转发")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /proc/sys/net/ipv4/ip_forward\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 将发往 B 的请求转发给 C")]),a._v("\niptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" OUTPUT "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.2")]),a._v(".3.4 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" DNAT --to-destination "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.6")]),a._v(".7.8\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("blockquote",[s("p",[s("strong",[a._v("效果")]),a._v("：本地发往 "),s("code",[a._v("1.2.3.4")]),a._v("（B）的请求实际上变成了发往 "),s("code",[a._v("5.6.7.8")]),a._v("（C）")])]),a._v(" "),s("h4",{attrs:{id:"❗注意"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#❗注意"}},[a._v("#")]),a._v(" ❗注意：")]),a._v(" "),s("ul",[s("li",[a._v("这种方式只对本地程序发出的请求有效（A 自己发出的）")]),a._v(" "),s("li",[a._v("如果你要让 A 成为一个“路由器”帮别的机器转发，则需要额外设置转发规则（下文方法 2）")])]),a._v(" "),s("hr"),a._v(" "),s("h3",{attrs:{id:"方法-2-a-是网关-其他机器也要走这个路由-更复杂"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方法-2-a-是网关-其他机器也要走这个路由-更复杂"}},[a._v("#")]),a._v(" 方法 2：A 是网关，其他机器也要走这个路由（更复杂）")]),a._v(" "),s("p",[a._v("如果 A 是某个网段的网关，比如你希望 "),s("strong",[a._v("A 代表整个局域网的路由器")]),a._v("，让其他机器发往 B 的包都自动重定向到 C：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启用路由转发")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /proc/sys/net/ipv4/ip_forward\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# DNAT 把目标为 B 的请求转发给 C")]),a._v("\niptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" PREROUTING "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.2")]),a._v(".3.4 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" DNAT --to-destination "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.6")]),a._v(".7.8\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# SNAT 修改源地址为 A 自己，避免 C 无法返回")]),a._v("\niptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" POSTROUTING "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" MASQUERADE\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("blockquote",[s("p",[a._v("前提：客户端机器的默认网关是 A")])]),a._v(" "),s("hr"),a._v(" "),s("h2",{attrs:{id:"🚫-无法实现的场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🚫-无法实现的场景"}},[a._v("#")]),a._v(" 🚫 无法实现的场景：")]),a._v(" "),s("ul",[s("li",[a._v("如果 A 是普通客户端，而你无法修改其路由或 iptables，那么就无法实现。")]),a._v(" "),s("li",[a._v("如果 A 不控制网络出口（如出网由运营商管理），则无法通过这种方式转发。")])]),a._v(" "),s("hr"),a._v(" "),s("h2",{attrs:{id:"✅-总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#✅-总结"}},[a._v("#")]),a._v(" ✅ 总结")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("目标")]),a._v(" "),s("th",[a._v("可否实现")]),a._v(" "),s("th",[a._v("方式")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("A 发起请求给 B，实际去 C")]),a._v(" "),s("td",[a._v("✅ 可以")]),a._v(" "),s("td",[a._v("在 A 上用 iptables 做 DNAT")])]),a._v(" "),s("tr",[s("td",[a._v("整个局域网内所有设备都请求 B，实际到 C")]),a._v(" "),s("td",[a._v("✅ 可以")]),a._v(" "),s("td",[a._v("A 必须是这些设备的网关，配置转发")])]),a._v(" "),s("tr",[s("td",[a._v("A 不可控")]),a._v(" "),s("td",[a._v("❌ 不可行")]),a._v(" "),s("td",[a._v("无法修改其路由表")])])])]),a._v(" "),s("hr"),a._v(" "),s("p",[a._v("如果你能告诉我 A 是 Linux、Windows、还是网关路由器设备，我可以给你更具体的命令。")]),a._v(" "),s("p",[a._v("是否需要我提供 "),s("strong",[a._v("Windows 系统修改路由/防火墙实现的方式")]),a._v("？")])])}),[],!1,null,null,null);s.default=e.exports}}]);